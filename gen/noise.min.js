this.audioLib=function AUDIOLIB(m,l,y,r){function s(f){f=new ga(f);f.subarray=f.subarray||f.slice;return f}function z(f,a,b,e){S?S(f,a,{get:function(){return b},enumerable:!!e}):f[a]=b}function W(f){var a=arguments,b=a.length,e,c;for(e=1;e<b;e++)for(c in a[e])a[e].hasOwnProperty(c)&&(f[c]=a[e][c]);return f}function T(f,a,b){var e;if(!b)if(b=[],e=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(a))e[1].replace(/[a-z$_0-9]+/ig,function(a){b.push(a)});else for(e=0;e<a.length;e++)b[e]=r(e+2).join("_");f=Function("var __q;return function "+
f+"("+b.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+f+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+f+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")();f.prototype=a.prototype;f.prototype.__CLASSCONSTRUCTOR=a;W(f,a);return f}function U(f,a,b,e){this.parameter=f;this.automation=a;this.amount=isNaN(b)?this.amount:b;this.setType(e)}function x(f,a,b,e,c){if(!f.automation)switch(f.automation=[],f.type){case "generator":f.append=x.generatorAppend;break;case "effect":f.append=
x.effectAppend;break;case "buffereffect":f.append=x.bufferEffectAppend}b=new U(a,b,e,c);f.automation.push(b);return b}function X(f,a,b){function e(){f.apply(this,b)}this.channelCount=isNaN(a)?this.channelCount:a;this.effects=[];for(e.prototype=f.prototype;a--;)this.effects.push(new e)}function B(f,a){var b=f[0].toUpperCase()+f.substr(1).toLowerCase();B[f]=a;a.decode&&(k.Sampler.prototype["load"+b]=function(a){this.load.apply(this,[B[f].decode(a)].concat([].slice.call(arguments,1)))});a.encode&&(k.AudioDevice.Recording.prototype["to"+
b]=function(a){return B[f].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:a})});return a}function E(){var f=r.prototype.splice.call(arguments,0),a=f.prototype=E.prototype;for(i in a)a.hasOwnProperty(i)&&(f[i]=a[i]);return f}function G(){}function V(){}function H(f,a){H[f]=a;H._pluginList.push({plugin:a,name:f})}function Y(f,a,b,e,c,d,h){this.sampleRate=isNaN(f)?this.sampleRate:f;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?
this.decay:b;this.sustain=isNaN(e)?this.sustain:e;this.release=isNaN(c)?this.release:c;this.sustainTime=isNaN(d)?null:d;this.releaseTime=isNaN(h)?null:h}function Z(f,a,b,e){this.sampleRate=isNaN(f)?this.sampleRate:f;this.stepLength=isNaN(a)?this.stepLength:a;this.steps=b||[1,0];this.attack=isNaN(e)?this.attack:e}function $(f,a){this.sampleRate=isNaN(f)?this.sampleRate:f;this.schedule=[];this.reset(a)}function p(f,a,b,e,c,d){this.reset.apply(this,arguments)}function aa(f,a,b,e){this.sampleRate=f;this.buffer=
new s(isNaN(a)?1200:a);this.bufferSize=this.buffer.length;this.feedback=isNaN(b)?this.feedback:b;this.damping=isNaN(e)?this.damping:e;this.invDamping=1-this.damping}function J(f,a,b){this.time=isNaN(a)?this.time:a;this.feedback=isNaN(b)?this.feedback:b;this.reset(f)}function A(f,a,b,e,c,d,h){var g=this;g.sampleRate=f;g.channelCount=isNaN(a)?g.channelCount:a;g.wet=isNaN(b)?g.wet:b;g.dry=isNaN(e)?g.dry:e;g.roomSize=isNaN(c)?g.roomSize:c;g.damping=isNaN(d)?g.damping:d;g.tuning=new A.Tuning(h||g.tuning);
g.sample=function(){var a=[],b;for(b=0;b<g.channelCount;b++)a[b]=0;return a}();g.CFs=function(){var a=[],b=[],d=g.tuning.combCount,c=g.damping*g.tuning.scaleDamping,e=g.roomSize*g.tuning.scaleRoom+g.tuning.offsetRoom,f=g.tuning.combTuning,h,l;for(l=0;l<g.channelCount;l++){for(h=0;h<d;h++)b.push(new k.CombFilter(g.sampleRate,f[h]+l*g.tuning.stereoSpread,e,c));a.push(b);b=[]}return a}();g.numCFs=g.CFs[0].length;g.APFs=function(){var a=[],b=[],d=g.tuning.allPassCount,c=g.tuning.allPassFeedback,e=g.tuning.allPassTuning,
f,h;for(h=0;h<g.channelCount;h++){for(f=0;f<d;f++)b.push(new A.AllPassFilter(g.sampleRate,e[f]+h*g.tuning.stereoSpread,c));a.push(b);b=[]}return a}();g.numAPFs=g.APFs[0].length}function ba(f,a){this.sampleRate=isNaN(f)?this.sampleRate:f;this.gain=isNaN(a)?this.gain:a}function R(f,a,b,e){var c=this,d=[0,0,0,0],h,g,j,n,C=l.sin,v=l.min,I=l.pow;c.cutoff=isNaN(a)?2E4:a;c.resonance=!b?0.1:b;c.samplerate=isNaN(f)?44100:sampleRate;c.type=e||0;c.pushSample=function(a){if(j!==c.cutoff||n!==c.resonance)h=2*
C(l.PI*v(0.25,c.cutoff/(2*c.samplerate))),g=v(2*(1-I(c.resonance,0.25)),v(2,2/h-0.5*h)),j=c.cutoff,n=c.resonance;d[3]=a-g*d[2];d[0]+=h*d[2];d[1]=d[3]-d[0];d[2]=h*d[1]+d[2];d[3]=a-g*d[2];d[0]+=h*d[2];d[1]=d[3]-d[0];d[2]=h*d[1]+d[2];return d[c.type]};c.getMix=function(a){return d[a||c.type]}}function ca(f,a,b,e){this.sampleRate=isNaN(f)?this.sampleRate:f;this.threshold=isNaN(a)?this.threshold:a;this.attack=isNaN(b)?this.attack:b;this.release=isNaN(e)?this.release:e;this._amplitude=new k.Amplitude(this.sampleRate,
this.attack,this.release)}function da(f){console.log(f);this.reset(f)}function K(f,a){this.frequency=isNaN(a)?440:a;this.waveTable=new s(1);this.sampleRate=f;this.waveShapes=this.waveShapes.slice(0)}function ea(f,a){this.voices=[];this.sampleRate=f;this.pitch=isNaN(a)?440:this.pitch}function fa(f,a,b){this.sampleRate=isNaN(f)?this.sampleRate:f;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?this.decay:b}function F(f){for(var a in F.prototype)F.prototype.hasOwnProperty(a)&&(this[a]=F.prototype[a]);
this.resetBuffer.apply(this,arguments)}var ga=m.Float32Array||r,k=this;k.Float32Array=s;var S=function(){if(y.defineProperty)return y.defineProperty;if(y.prototype.__defineGetter__)return function(f,a,b){b.get&&f.__defineGetter__(a,b.get);b.set&&f.__defineSetter__(a,b.set)}}();z(k,"__define",S);z(k,"__defineConst",z);z(k,"__extend",W);z(k,"__enum",function(f,a,b){for(var e in f)(f.hasOwnProperty(e)||b)&&a.call(f,f[e],e);return f});z(k,"__class",T);U.prototype={parameter:"",automation:null,amount:1,
type:"modulation",mode:null,setType:function(f){if(f){if("function"===typeof f)this.type=f.name||"custom",this.mode=f;this.type=f;this.mode=x.modes[f]}else this.mode=this.mode||x.modes[this.type]}};x.generatorAppend=function(f,a,b){var e=f.length,c=this.automation.length,d=[],h,g,j,n,b=b||f,a=a||this.channelCount;for(j=0;j<c;j++)d.push(this[this.automation[j].parameter]);for(g=0,h=0;g<e;g+=a,h++){for(j=0;j<c;j++)this[this.automation[j].parameter]=d[j];for(j=0;j<c;j++)n=this.automation[j],n.mode(this,
n.parameter,n.amount*n.automation.generatedBuffer[h]);this.generate();for(j=0;j<a;j++)b[g+j]=this.getMix(j)*this.mix+f[g+j]}for(j=0;j<c;j++)this[this.automation[j].parameter]=d[j];return b};x.effectAppend=function(f,a,b){var e=f.length,c=this.automation.length,d=[],h,g,j,n,b=b||f,a=a||this.channelCount;for(j=0;j<c;j++)d.push(this[this.automation[j].parameter]);for(g=0,h=0;g<e;g+=a,h++){for(j=0;j<c;j++)this[this.automation[j].parameter]=d[j];for(j=0;j<c;j++)n=this.automation[j],n.mode(this,n.parameter,
n.amount*n.automation.generatedBuffer[h]);for(j=0;j<a;j++)this.pushSample(f[g+j],j),b[g+j]=this.getMix(j)*this.mix+f[g+j]*(1-this.mix)}for(j=0;j<c;j++)this[this.automation[j].parameter]=d[j];return b};x.bufferEffectAppend=function(f,a,b){var a=a||this.channelCount,e=f.length,c=this.automation.length,d=[],h,g,j,n,C,b=b||f;for(j=0;j<c;j++){d.push([]);for(g=0;g<a;g++)d[j].push(this.effects[g][this.automation[j].parameter])}for(C=0,h=0;h<e;h+=a,C++)for(g=0;g<a;g++){for(j=0;j<c;j++)n=this.automation[j],
this.effects[g][n.parameter]=d[j][g],n.mode(this.effects[g],n.parameter,n.amount*n.automation.generatedBuffer[C]);b[h+g]=this.effects[g].pushSample(f[h+g])*this.mix+f[h+g]*(1-this.mix)}for(j=0;j<c;j++)for(g=0;g<a;g++)this.effects[g][this.automation[j].parameter]=d[j][g];return b};x.modes={modulation:function(f,a,b){f.setParam(a,f[a]*b)},addition:function(f,a,b){f.setParam(a,f[a]+b)},subtraction:function(f,a,b){f.setParam(a,f[a]-b)},additiveModulation:function(f,a,b){f.setParam(a,f[a]+f[a]*b)},subtractiveModulation:function(f,
a,b){f.setParam(a,f[a]-f[a]*b)},assignment:function(f,a,b){f.setParam(a,b)},absoluteAssignment:function(f,a,b){f.setParam(a,l.abs(b))}};x.__constructror=U;X.prototype={mix:0.5,type:"buffereffect",channelCount:2,append:function(f,a,b){var e=f.length,c,d,a=a||this.channelCount,b=b||f;for(c=0;c<e;c+=a)for(d=0;d<a;d++)this.effects[d].pushSample(f[c+d],0),b[c+d]=this.effects[d].getMix(0)*this.mix+f[c+d]*(1-this.mix);return b},join:function(){return BufferEffectChain.apply(0,[this].concat(r.prototype.splice.call(arguments,
0)))},addPreProcessing:function(){var f;for(f=0;f<this.effects.length;f++)this.effects[f].addPreProcessing.apply(this.effects[f],arguments)},removePreProcessing:function(){var f;for(f=0;f<this.effects.length;f++)this.effects[f].removePreProcessing.apply(this.effects[f],arguments)},setParam:function(f,a){var b=this.effects.length,e;for(e=0;e<b;e++)this.effects[e].setParam(f,a)}};(function(f){E.prototype=f;f.pushSample=function(a){var b,f;for(f=0;f<this.length;f++)b=this[f].mix,a=this[f].pushSample(a)*
b+a*(1-b);return a}})(new G);G.prototype={type:"effect",sink:!0,source:!0,mix:0.5,channelCount:1,append:function(f,a,b){var e=f.length,c,d,b=b||f,a=a||this.channelCount;for(c=0;c<e;c+=a)for(d=0;d<a;d++)this.pushSample(f[c+d],d),b[c+d]=this.getMix(d)*this.mix+f[c+d]*(1-this.mix);return b},join:function(){return E.apply(0,[this].concat(r.prototype.splice.call(arguments,0)))},addPreProcessing:function(f){f.pushSample=this.pushSample;this.pushSample=function(){f.apply(this,arguments);return f.pushSample.apply(this,
arguments)}},removePreProcessing:function(f){for(var a;a=this.pushSample.pushSample;)if(a===f||!f)this.pushSample=a,f.pushSample=null},setParam:function(f,a){this[f]=a},pushSample:function(){},getMix:function(){},reset:function(){}};V.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(f,a,b){var e=f.length,c,d,b=b||f,a=a||this.channelCount;for(c=0;c<e;c+=a){this.generate();for(d=0;d<a;d++)b[c+d]=this.getMix(d)*this.mix+f[c+d]}return b},addPreProcessing:function(f){f.generate=
this.generate;this.generate=function(){f.apply(this,arguments);return f.generate.apply(this,arguments)}},removePreProcessing:function(f){for(var a;a=this.generate.generate;)if(a===f||!f)this.generate=a,f.generate=null},generateBuffer:function(f,a){this.generatedBuffer=new s(f);this.append(this.generatedBuffer,a||1)},setParam:function(f,a){this[f]=a},generate:function(){},getMix:function(){},reset:function(){}};z(H,"_pluginList",[],!1);Y.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,
sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){this.states[this.state].call(this);return this.value},getMix:function(){return this.value},triggerGate:function(f){this.state=(this.gate=f="undefined"===typeof f?!this.gate:f)?0:null===this.releaseTime?3:5;this._st=0},states:[function(){this.value+=1E3/this.sampleRate/this.attack;if(1<=this.value)this.state=1},function(){this.value-=1E3/this.sampleRate/this.decay*this.sustain;if(this.value<=this.sustain)null===this.sustainTime?
this.state=2:(this._st=0,this.state=4)},function(){this.value=this.sustain},function(){this.value=l.max(0,this.value-1E3/this.sampleRate/this.release)},function(){this.value=this.sustain;if(this._st++>=0.0010*this.sampleRate*this.sustainTime)this._st=0,this.state=null===this.releaseTime?3:5},function(){this.value=l.max(0,this.value-1E3/this.sampleRate/this.release);if(this._st++>=0.0010*this.sampleRate*this.releaseTime)this.state=this._st=0}]};Z.prototype={sampleRate:44100,stepLength:200,steps:null,
attack:0,phase:0,value:0,generate:function(){var f=this.steps,a=this.sampleRate/1E3*this.stepLength*f.length,b,e;this.phase=(this.phase+1)%a;b=this.phase/a*f.length;a=b%1;b=l.floor(b);e=f[b]-f[(b||f.length)-1];f=f[b];a<this.attack&&(f-=e-e/this.attack*a);return this.value=f},getMix:function(){return this.value},triggerGate:function(){this.phase=0}};$.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var f;for(f=0;f<this.schedule.length;f++)if(this.schedule[f].t--)this.value=
this.schedule[f].v,this.schedule.splice(f--,1)},setValue:function(f){this.schedule.push({v:f,t:~~((+new Date-this.clock)/1E3*this.sampleRate)})},reset:function(f){this.value=isNaN(f)?this.value:f;this.clock=+new Date}};p.BiquadFilterClass=function a(){for(var b in a.prototype)a.prototype.hasOwnProperty&&(this[b]=this[b])};p.BiquadFilterClass.prototype={sampleRate:44100,sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(a){var b=this.coefs,e=this.inputs,c=this.outputs;this.sample=b.b0*
a+b.b1*e[0]+b.b2*e[1]-b.a1*c[0]-b.a2*c[1];e.pop();e.unshift(a);c.pop();c.unshift(this.sample);return this.sample},getMix:function(){return this.sample},reset:function(a,b,e,c,d,h){this.inputs=[0,0];this.outputs=[0,0];this.sampleRate=isNaN(a)?this.sampleRate:a;if(1<arguments.length)this.coefs={b0:b,b1:e,b2:c,a1:d,a2:h}}};p.LowPass=function(a,b,e){var c=2*l.PI*b/a,b=l.cos(c),e=l.sin(c)/(2*e),c=(1-b)/2,d=1+e;this.reset(a,c/d,(1-b)/d,c/d,-2*b/d,(1-e)/d)};p.HighPass=function(a,b,e){var c=2*l.PI*b/a,b=
l.cos(c),e=l.sin(c)/(2*e),c=(1+b)/2,d=1+e;this.reset(a,c/d,-(1+b)/d,c/d,-2*b/d,(1-e)/d)};p.AllPass=function(a,b,e){var c=2*l.PI*b/a,b=l.cos(c),c=l.sin(c)/(2*e),e=1-c,b=-2*b,c=1+c;this.reset(a,e/c,b/c,c/c,b/c,e/c)};p.BandPass=function(a,b,e){var c=2*l.PI*b/a,b=l.cos(c),d=l.sin(c),e=l.log(2)/2*e*c/d,e=d*(l.exp(e)-l.exp(-e))/2,d=1+e;this.reset(a,e/d,0/d,-e/d,-2*b/d,(1-e)/d)};(function(a,b){for(b=0;b<a.length;b++)a[b].prototype=new p.BiquadFilterClass})([p,p.LowPass,p.HighPass,p.AllPass,p.BandPass]);
aa.prototype={sample:0,index:0,store:0,feedback:0.84,damping:0.2,pushSample:function(a){this.sample=this.buffer[this.index];this.store=this.sample*this.invDamping+this.store*this.damping;this.buffer[this.index++]=a+this.store*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},reset:function(){this.samples=this.index=this.store=0;this.buffer=new s(this.bufferSize)},setParam:function(a,b){switch(a){case "damping":this.damping=b;this.invDamping=
1-b;break;default:this[a]=b}}};J.prototype={sampleRate:1,time:1E3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(a){var b=this.buffer;b[this.bufferPos++]+=a;if(this.bufferPos>this.time*this._rstf)this.bufferPos=0;this.sample=b[this.bufferPos];b[this.bufferPos]*=this.feedback;return this.sample},getMix:function(){return this.sample},resample:function(a){var b=this.time/a;this.buffer=k.Sink.resample(this.buffer,a);this.time=a;this.bufferPos=l.round(b*this.bufferPos);return this.buffer},
reset:function(a,b){var e=this.buffer,c,a=isNaN(a)?this.sampleRate:a;c=this.sampleRate/a;this.buffer=new s(a*J.MAX_DELAY);this.bufferPos=l.round(c*this.bufferPos);this._rstf=0.0010*a;if(b){e=k.Sink.resample(e,c);for(c=0;c<e.length&&c<this.buffer.length;c++)this.buffer[c]=e[c]}return this.buffer}};J.MAX_DELAY=2;A.prototype={channelCount:2,sample:[0,0],wet:0.5,dry:0.55,damping:0.2223,roomSize:0.5,tuning:{},pushSample:function(a,b){var e=a*this.tuning.fixedGain,c=0,d;for(d=0;d<this.numCFs;d++)c+=this.CFs[b][d].pushSample(e);
for(d=0;d<this.numAPFs;d++)c=this.APFs[b][d].pushSample(c);this.sample[b]=c*this.wet+a*this.dry},getMix:function(a){return this.sample[a]},reset:function(){var a,b;for(b=0;b<this.channelCount;b++){for(a=0;a<this.numCFs;a++)this.CFs[b][a].reset();for(a=0;a<this.numAPFs;a++)this.APFs[b][a].reset();this.sample[b]=0}},setParam:function(a,b){var e,c,d;switch(a){case "roomSize":this.roomSize=b;e=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom;for(d=0;d<this.channelCount;d++)for(c=0;c<this.numCFs;c++)this.CFs[d][c].setParam("feedback",
e);break;case "damping":this.damping=b;e=this.damping*this.tuning.scaleDamping;for(d=0;d<this.channelCount;d++)for(c=0;c<this.numCFs;c++)this.CFs[d][c].setParam("damping",e);break;default:this[a]=b}}};A.Tuning=function(a){var b;if(a)for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};A.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:0.5,fixedGain:0.015,scaleDamping:0.9,scaleRoom:0.28,offsetRoom:0.7,stereoSpread:23};
A.AllPassFilter=function(a,b,e){this.sampleRate=a;this.buffer=new s(isNaN(b)?500:b);this.bufferSize=this.buffer.length;this.feedback=isNaN(e)?this.feedback:e};A.AllPassFilter.prototype={sample:0,index:0,feedback:0.5,pushSample:function(a){bufOut=this.buffer[this.index];this.sample=-a+bufOut;this.buffer[this.index++]=a+bufOut*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},reset:function(){this.sample=this.index=0;this.buffer=new s(this.bufferSize)}};
ba.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(a){return this.sample=a*this.gain},getMix:function(){return this.sample}};ca.prototype={sampleRate:44100,threshold:0.95,attack:0.01,release:0.01,__amplitude:null,sample:0,pushSample:function(a){var b=this._amplitude.pushSample(a)-this.threshold;return this.sample=0<b?a/(1+b):a},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case "attack":case "release":this._amplitude[a]=b;default:this[a]=b}}};da.prototype=
{sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(a){this.sampleRate=isNaN(a.sampleRate)?this.sampleRate:a.sampleRate;this.color="string"===typeof a.color?a.color:this.color;this.c1=(1<<this.q)-1;this.c2=~~(this.c1/3)+1;this.c3=1/this.c1;this.c1=6*this.c2;this.c4=3*(this.c2-1);this.q0=l.exp(-200*l.PI/this.sampleRate);this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},
white:function(){return(l.random()*this.c1-this.c4)*this.c3},pink:function(){var a=this.white();this.b0=0.997*this.b0+0.029591*a;this.b1=0.985*this.b1+0.032534*a;this.b2=0.95*this.b2+0.048056*a;this.b3=0.85*this.b3+0.090579*a;this.b4=0.62*this.b4+0.10899*a;this.b5=0.25*this.b5+0.255784*a;return 0.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){this.brownQ=this.q1*this.white()+this.q0*this.brownQ;return 6.2*this.brownQ}};(function(a,b,e,c){e=K.prototype={sampleRate:44100,frequency:440,
phaseOffset:0,pulseWidth:0.5,fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var a=+this.frequency,b=this.pulseWidth,c=this.phase,a=a+a*this.fm;this.phase=(c+a/this.sampleRate/2)%1;c=(this.phase+this.phaseOffset)%1;this._p=c<b?c/b:(c-b)/(1-b)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(a){this.phase=this._p=isNaN(a.p)?0:a.p},setWavetable:function(a){this.waveTable=a;return!0},sine:function(){return l.sin(this._p*a)},triangle:function(){return 0.5>
this._p?4*this._p-1:3-4*this._p},square:function(){return 0.5>this._p?-1:1},sawtooth:function(){return 1-2*this._p},invSawtooth:function(){return 2*this._p-1},pulse:function(){return 0.5>this._p?0.25>this._p?8*this._p-1:1-8*(this._p-0.25):-1},wavetable:function(){return k.Sink.interpolate(this.wavetable,this._p*this.wavetable.length)},waveShapes:[]};for(c=0;c<b.length;c++)e[c]=e[b[c]],e.waveShapes.push(e[c]);K.WaveShape=function(a,b){b&&(this.prototype[a]=b);return this.prototype[a]};K.createMixWave=
function(a,b){var c=b.length,e,n;return this.WaveShape(a,function(){for(n=e=0;n<c;n++)e+=this[b[n].shape]()*b[n].mix;return e})}})(2*l.PI,"sine,triangle,pulse,sawtooth,invSawtooth,square".split(","));ea.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(a,b){var a=isNaN(a)?this.pitch:a,e=this.sampleRate,c=this.sampleSize-e*this.delayEnd-1,e={f:a,p:e*this.delayStart,s:a/this.pitch,l:c,v:isNaN(b)?1:
b};for(this.voices.push(e);this.voices.length>this.maxVoices;)c=this.voices.shift(),c.onend&&c.onend();return e},generate:function(){var a=this.voices,b,e;for(b=0;b<a.length;b++)e=a[b],e.p+=e.s,e.p>e.l&&a.splice(b--,1)&&e.onend&&e.onend()},getMix:function(a){var b=this.voices,e=0,c,a=a||0;if(this.samples[a])for(c=0;c<b.length;c++)e+=k.Sink.interpolate(this.samples[a],b[c].p)*b[c].v;return e},load:function(a,b){var e=this.samples=k.Sink.deinterleave(a.data,a.channelCount),c;if(b)for(c=0;c<e.length;c++)e[c]=
k.Sink.resample(e[c],a.sampleRate,this.sampleRate);this.sample=a.data;this.samples=e;this.data=a;this.sampleSize=e[0].length}};(function(){function a(){var a=arguments,e=a.length,c,d;for(d=0;d<e;d++)c=a[d],this.postMessage({type:"injection",code:c instanceof Function?"("+c+").call(this);":c})}k.AudioWorker=function(b,e){var c="var audioLib=("+AUDIOLIB+"(this, Math, Object, Array));\n",d;for(d=0;d<k.plugins._pluginList.length;d++)c+="("+k.plugins._pluginList[url]+"());\n";e&&(c+='this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)},true);\n');
c=Sink.inlineWorker(c+(b instanceof Function?"("+b+").call(this);":b));if(e)c.inject=a;return c}})();(function(a,b){function e(a,b){return b?h(a&255)+e(a>>8,b-1):""}function c(a,b){return b?c(a>>8,b-1)+h(255-a&255):""}function d(a,c,n,e){var v=b.pow,h=b.floor,t=d.convertFromBinary,D=d.convertToBinary,l=a/8,k=v(2,a),o=k/2,w=o-1,ha=1/o,m=1/w;return e?n?c?function(a,b){a=h(0>a?a*o+k:a*w);return D(a,l,b)}:function(a,b){return D(h(a*w),l,b)}:c?function(a,b){return D(0>a?a+k:a,l,b)}:function(a,b){return D(a,
l,b)}:n?c?function(a,b){var c=t(a,b);return c>w?(c-k)*ha:c*m}:function(a,b){return t(a,b)*m}:c?function(a,b){var c=t(a,b);return c>w?c-k:c}:function(a,b){return t(a,b)}}var h=String.fromCharCode;d.convertToBinary=function(a,b,d){return d?c(a,b):e(a,b)};d.convertFromBinary=function(a,c){var d=a.length,e=d-1,v=0,h=b.pow,t;if(c)for(t=0;t<d;t++)v+=(255-a.charCodeAt(t))*h(256,e-t);else for(t=0;t<d;t++)v+=a.charCodeAt(t)*h(256,t);return v};d.fromQ32=d(32,!0,!0,!0);d.toQ32=d(32,!0,!0,!1);d.fromQ24=d(24,
!0,!0,!0);d.toQ24=d(24,!0,!0,!1);d.fromQ16=d(16,!0,!0,!0);d.toQ16=d(16,!0,!0,!1);d.fromQ8=d(8,!0,!0,!0);d.toQ8=d(8,!0,!0,!1);d.fromInt32=d(32,!0,!1,!0);d.toInt32=d(32,!0,!1,!1);d.fromInt16=d(16,!0,!1,!0);d.toInt16=d(16,!0,!1,!1);d.fromInt8=d(8,!0,!1,!0);d.toInt8=d(8,!0,!1,!1);d.fromUint32=d(32,!1,!1,!0);d.toUint32=d(32,!1,!1,!1);d.fromUint16=d(16,!1,!1,!0);d.toUint16=d(16,!1,!1,!1);d.fromUint8=d(8,!1,!1,!0);d.toUint8=d(8,!1,!1,!1);a.Binary=d})(this,l);(function(a,b){function e(a){this.data=a}function c(a,
b,c){var e=b/8;d["read"+a+b]=function(a){return c(this.read(e),a)}}var d=e.prototype={read:function(a){var b=this.data.substr(0,a);this.skip(a);return b},skip:function(a){var b=this.data=this.data.substr(a);this.pointer+=a;return b.length},readBuffer:function(a,b,c){for(var b="read"+c+b,c=a.length,d=0;this.data&&d<c;)a[d++]=this[b]();return d}},h,g;for(h in b)(g=/to([a-z]+)([0-9]+)/i.exec(h))&&c(g[1],g[2],b[h]);a.Stream=e;e.newType=c})(this,this.Binary);this.PCMData=function(a,b){function e(a){return("string"===
typeof a?e.decode:e.encode)(a)}e.decodeFrame=function(a,d,e){if(8===d){var g=new (window.Uint8Array||r)(e.length);(new b(a)).readBuffer(g,8,"Uint");for(d=0;d<e.length;d++)e[d]=127.5*(g[d]-127.5)}else(new b(a)).readBuffer(e,d,"Q");return e};e.encodeFrame=function(b,d){var e=a[(8===d?"fromUint":"fromQ")+d],g=b.length,j="",n;if(8===d)for(n=0;n<g;n++)j+=e(127.5*b[n]+127.5);else for(n=0;n<g;n++)j+=e(b[n]);return j};e.decode=function(a,d){function h(){t=g.read(4);D=g.readUint32();k=g.read(D);w=m[t]=m[t]||
[];"data"===t?(l=~~(D/I),o=p.data=new ("undefined"!==typeof s?s:r)(l),e.decodeFrame(k,8*I,o)):w.push(k);d&&(g.data?setTimeout(h,1):d(p))}var g=new b(a);g.read(4);var j=g.readUint32(),g=new b(g.read(j));g.read(4);g.read(4);j=g.readUint32();j=new b(g.read(j));j.readUint16();var n=j.readUint16();j.readUint32();var C=j.readUint32(),v=j.readUint16(),I=v/n;j.readUint16();var t,D,l,k,o,w,m={},p={channelCount:n,bytesPerSample:v/n,sampleRate:C/v,chunks:m,data:o};if(d)g.data?h():d(p);else for(;g.data;)h();
return p};e.encode=function(b,d){var h=a.fromUint32,g=a.fromUint16,j=b.data,n=b.sampleRate,C=b.channelCount||1,v=b.bytesPerSample||1,I=8*v,t=C*v,D=n*t,k=j.length*v;l.pow(2,I-1);var u=[],v="",o;u.push("fmt "+h(16)+g(1)+g(C)+h(n)+h(D)+g(t)+g(I));u.push("data"+h(k)+e.encodeFrame(j,I));if(n=b.chunks)for(o in n)if(n.hasOwnProperty(o)){g=n[o];for(j=0;j<g.length;j++)v=g[j],u.push(o+h(v.length)+v)}u=u.join("");u="RIFF"+h(u.length)+"WAVE"+u;d&&setTimeout(function(){d(u)},1);return u};return e}(this.Binary,
this.Stream);(function(a){function b(a,c,d,e){var g=b.sinks,h;for(h in g)if(g.hasOwnProperty(h)&&g[h].enabled)try{return new g[h](a,c,d,e)}catch(j){}throw b.Error(2);}function e(){for(var a in e.prototype)e.prototype.hasOwnProperty(a)&&(this[a]=e.prototype[a]);this._listeners={}}function c(a){if(!c.hasOwnProperty(a))throw c(1);if(!(this instanceof c))return new c(a);for(var b in c[a])c[a].hasOwnProperty(b)&&(this[b]=c[a][b]);this.code=a}function d(a){this.boundTo=a;this.buffers=[];a.activeRecordings.push(this)}
function h(){}function g(a,c,d,e){d=d||c.prototype;c.prototype=new b.SinkClass;c.prototype.type=a;c.enabled=!e;for(e in d)d.hasOwnProperty(e)&&(c.prototype[e]=d[e]);g[a]=c}e.prototype={_listeners:null,emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b);return this},on:function(a,b){this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this},off:function(a,b){if(this._listeners[a]){if(!b)return delete this._listeners[a],
this;for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c]===b&&this._listeners[a].splice(c--,1);this._listeners[a].length||delete this._listeners[a]}return this}};b.EventEmitter=e;c.prototype=Error();c.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message};c[1]={message:"No such error code.",explanation:"The error code does not exist."};c[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."};
c[16]={message:"Buffer underflow.",explanation:"Trying to recover..."};c[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."};c[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."};b.Error=c;d.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=
[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,c=this.buffers,d,e,g=c.length;for(e=0;e<g;e++)a+=c[e].length;a=new s(a);for(e=0;e<g;e++){for(d=0;d<c[e].length;d++)a[b+d]=c[e][d];b+=c[e].length}return a}};b.SinkClass=h;h.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,writeMode:"async",channelMode:"interleaved",previousHit:0,ringBuffer:null,ringOffset:0,start:function(a,c,d,e){this.channelCount=
isNaN(c)||null===c?this.channelCount:c;this.bufferSize=isNaN(d)||null===d?this.bufferSize:d;this.sampleRate=isNaN(e)||null===e?this.sampleRate:e;this.readFn=a;this.activeRecordings=[];this.previousHit=+new Date;this.asyncBuffers=[];this.syncBuffers=[];b.EventEmitter.call(this)},process:function(a,c){this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);this.writeBuffersSync.apply(this,arguments);if("interleaved"===this.channelMode)this.readFn&&
this.readFn.apply(this,arguments),this.emit("audioprocess",arguments);else{var d=b.deinterleave(a,this.channelCount),e=[d].concat([].slice.call(arguments,1));this.readFn&&this.readFn.apply(this,e);this.emit("audioprocess",e);b.interleave(d,this.channelCount,a)}this.writeBuffersAsync.apply(this,arguments);this.recordData.apply(this,arguments);this.previousHit=+new Date;this.writePosition+=a.length/c},record:function(){return new d(this)},recordData:function(a){var b=this.activeRecordings,c,d=b.length;
for(c=0;c<d;c++)b[c].add(a)},writeBuffersAsync:function(a){var b=this.asyncBuffers,c=a.length,d,e,g,h,j;if(b)for(g=0;g<b.length;g++){d=b[g];e=d.b.length;j=d.d;d.d-=l.min(j,c);for(h=0;h+j<c&&h<e;h++)a[h+j]+=d.b[h];d.b=d.b.subarray(h+j);g>=e&&b.splice(g--,1)}},writeBuffersSync:function(a){for(var b=this.syncBuffers,c=a.length,d=0,e=0;d<c&&b.length;d++)a[d]+=b[0][e],b[0].length<=e?(b.splice(0,1),e=0):e++;b.length&&(b[0]=b[0].subarray(e))},writeBufferAsync:function(a,c){var a="deinterleaved"===this.mode?
b.interleave(a,this.channelCount):a,d=this.asyncBuffers;d.push({b:a,d:isNaN(c)?~~((+new Date-this.previousHit)/1E3*this.sampleRate):c});return d.length},writeBufferSync:function(a){var a="deinterleaved"===this.mode?b.interleave(a,this.channelCount):a,c=this.syncBuffers;c.push(a);return c.length},writeBuffer:function(){return this["async"===this.writeMode?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},getSyncWriteOffset:function(){var a=this.syncBuffers,b=0,c;for(c=0;c<a.length;c++)b+=
a[c].length;return b},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ringSpin:function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=this.ringOffset,g;for(g=0;g<c;g++)a[g]+=b[e],e=(e+1)%d;this.ringOffset=e},ringSpinDeinterleaved:function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=b[0].length,g=this.ringOffset,h,j;for(h=0;h<c;h+=d){for(j=0;j<d;j++)a[h+j]+=b[j][g];g=(g+1)%e}this.ringOffset=j}};g("moz",function(){function a(){if(e){h=g.mozWriteAudio(e);d+=h;if(h<e.length)return e=
e.subarray(h);e=null}j=g.mozCurrentSampleOffset();l=Number(j+(w!==j?c.bufferSize:c.preBufferSize)*c.channelCount-d);j===w&&c.emit("error",[b.Error(16)]);if(0<l||w===j){try{k=new s(w===j?c.preBufferSize*c.channelCount:l)}catch(n){c.emit("error",[b.Error(18)]);c.kill();return}c.process(k,c.channelCount);h=c._audio.mozWriteAudio(k);h<k.length&&(e=k.subarray(h));d+=h}w=j}var c=this,d=0,e=null,g=new Audio,h,j,l,k,w;c.start.apply(c,arguments);c.preBufferSize=isNaN(arguments[4])||null===arguments[4]?this.preBufferSize:
arguments[4];g.mozSetup(c.channelCount,c.sampleRate);this._timers=[];this._timers.push(b.doInterval(function(){if(2E3<+new Date-c.previousHit)c._audio=g=new Audio,g.mozSetup(c.channelCount,c.sampleRate),d=0,c.emit("error",[b.Error(17)])},1E3));this._timers.push(b.doInterval(a,20));c._bufferFill=a;c._audio=g},{bufferSize:24576,preBufferSize:24576,kill:function(){for(;this._timers.length;)this._timers[0](),this._timers.splice(0,1);this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/
this.channelCount}});var j=[];g("webkit",function(a,c,d,e){function h(a){var b=a.outputBuffer,a=b.numberOfChannels,c,d=b.length,e=new r(a),g=new s(d*a);for(c=0;c<a;c++)e[c]=b.getChannelData(c);k.process(g,k.channelCount);for(c=0;c<d;c++)for(b=0;b<a;b++)e[b][c]=g[c*k.channelCount+b]}var k=this,m=new (window.AudioContext||webkitAudioContext),u=m.createJavaScriptNode(d,0,c);k.start.apply(k,arguments);g.webkit.forceSampleRate&&k.sampleRate!==m.sampleRate?h=function(a){var c=a.outputBuffer,a=c.numberOfChannels,
d,e=c.length,g=new r(a),h=new s(l.floor(e*k.sampleRate/m.sampleRate)*a),j;for(d=0;d<a;d++)g[d]=c.getChannelData(d);k.process(h,k.channelCount);h=b.deinterleave(h,k.channelCount);for(c=0;c<a;c++){j=b.resample(h[c],k.sampleRate,m.sampleRate);for(d=0;d<e;d++)g[c][d]=j[d]}}:k.sampleRate=m.sampleRate;u.onaudioprocess=h;u.connect(m.destination);k._context=m;k._node=u;k._callback=h;j.push(u)},{kill:function(){this._node.disconnect(0);for(var a=0;a<j.length;a++)j[a]===this._node&&j.splice(a--,1);this._node=
this._context=null;this.kill();this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}});g.webkit.fix82795=j;g("dummy",function(){function a(){var b=new s(c.bufferSize*c.channelCount);c.process(b,c.channelCount)}var c=this;c.start.apply(c,arguments);c._kill=b.doInterval(a,1E3*(c.bufferSize/c.sampleRate));c._callback=a},{kill:function(){this._kill();this.emit("kill")}},!0);b.sinks=b.devices=g;b.Recording=d;(function(){function a(b){var e=null,g,h;try{return h=
new c,h.append(b),g=d.createObjectURL(h.getBlob()),e=new Worker(g),e._terminate=e.terminate,e._url=g,h=null,e.terminate=function(){d.revokeObjectURL(this._url)},a.type="blob",e}catch(j){}try{return e=new Worker("data:text/javascript;base64,"+btoa(b)),a.type="data",e}catch(k){}return e}var c="undefined"===typeof window?void 0:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,d="undefined"===typeof window?void 0:window.MozURL||window.webkitURL||
window.MSURL||window.OURL||window.URL;a.ready=a.working=!1;b.EventEmitter.call(a);a.test=function(){function b(c){if(!a.ready)a.ready=!0,a.working=c,a.emit("ready",[c]),a.off("ready")}var c=a("this.onmessage=function(e){postMessage(e.data)}");a.ready=a.working=!1;c?(c.onmessage=function(a){b("inlineWorker"===a.data)},c.postMessage("inlineWorker"),setTimeout(function(){b(!1)},1E3)):b(!1)};b.inlineWorker=a;a.test()})();b.doInterval=function(a,c){function d(h){b.inlineWorker.working&&!h?(e=b.inlineWorker('setInterval(function(){ postMessage("tic"); }, '+
c+");"),e.onmessage=function(){a()},g=function(){e.terminate()}):(e=setInterval(a,c),g=function(){clearInterval(e)})}var e,g;b.doInterval.backgroundWork||b.devices.moz.backgroundWork?b.inlineWorker.ready?d():b.inlineWorker.on("ready",function(){d()}):d(!0);return function(){g?g():b.inlineWorker.ready||b.inlineWorker.on("ready",function(){g&&g()})}};b.doInterval.backgroundWork=!0;(function(){function a(c,d){if(c&&d)a[c]=d;else if(c&&a[c]instanceof Function)b.interpolate=a[c];return a[c]}b.interpolation=
a;a("linear",function(a,b){var c=l.floor(b),d=c+1,e=b-c,d=d<a.length?d:0;return a[c]*(1-e)+a[d]*e});a("nearest",function(a,b){return b>=a.length-0.5?a[0]:a[l.round(b)]});a("linear")})();b.resample=function(a,c,d,e,g){var h=arguments.length,h=2===h?c:3===h?c/d:e/c*g/d,j=a.length,k=l.ceil(j/h),k=new s(k),o,m;for(o=0,m=0;o<j;o+=h)k[m++]=b.interpolate(a,o);return k};b.deinterleave=function(a,b){var c=a.length/b,d=[],e,g;for(e=0;e<b;e++){d[e]=new s(c);for(g=0;g<c;g++)d[e][g]=a[g*b+e]}return d};b.interleave=
function(a,b,c){var b=b||a.length,d=a[0].length,e=a.length,g,h,c=c||new s(d*b);for(g=0;g<e;g++)for(h=0;h<d;h++)c[g+h*b]=a[g][h];return c};b.mix=function(a){var b=[].slice.call(arguments,1),c,d,e;for(e=0;e<b.length;e++){c=l.max(a.length,b[e].length);for(d=0;d<c;d++)a[d]+=b[e][d]}return a};b.resetBuffer=function(a){var b=a.length,c;for(c=0;c<b;c++)a[c]=0;return a};b.clone=function(a,b){var c=a.length,d,b=b||new s(c);for(d=0;d<c;d++)b[d]=a[d];return b};b.createDeinterleaved=function(a,b){var c=new r(b),
d;for(d=0;d<b;d++)c[d]=new s(a);return c};a.Sink=b})(function(){return this}());fa.prototype={sampleRate:44100,attack:0.01,release:0.01,sample:0,pushSample:function(a){return this.sample=l.abs((a>this.sample?this.attack:this.release)*(this.sample-a)+a)},getMix:function(){return this.sample}};F.prototype={bufferPos:-1,pushSample:function(a){this.bufferPos=(this.bufferPos+1)%this.buffer.length;0===this.bufferPos&&this.process(this.buffer);return this.buffer[this.bufferPos]=a},getMix:function(){return this.buffer[this.bufferPos]},
resetBuffer:function(a){this.bufferSize=isNaN(a)?this.bufferSize:a;this.buffer=new s(this.bufferSize);this.bufferPos=-1}};m=function(){function a(a,b,j,k){var l=1,m=0,p=0.5*a.length,t=j.length,r,x,u,o;for(o=0;o<t;o++)if(u=j[o],l*=u,0===m?(r=a,x=b,m=1):(r=b,x=a,m=0),2===u){u=r;for(var w=x,A=k,y=0.5*u.length,z=0,L=0,F=y/2,y=y/l,B=l/2,K=1*B,P=new s(2),E=void 0,O=void 0,M=void 0,N=void 0,G=void 0,H=void 0,Q=void 0,J=void 0,N=M=void 0,E=0;E<y;E++,L+=K){O=P;Q=(A?d:-d)*E/(2*y);O[0]=c(Q);O[1]=e(Q);for(O=
0;O<B;O++,z++,L++)M=u[2*z],N=u[2*z+1],G=u[2*(z+F)],H=u[2*(z+F)+1],Q=M+G,J=N+H,M-=G,N-=H,w[2*L]=Q,w[2*L+1]=J,w[2*(L+B)]=P[0]*M-P[1]*N,w[2*(L+B)+1]=P[0]*N+P[1]*M}}if(k){if(1===m)for(o=0;o<p;o++)a[2*o]=b[2*o],a[2*o+1]=b[2*o+1]}else if(1===m)for(o=0;o<p;o++)a[2*o]=b[2*o]/p,a[2*o+1]=b[2*o+1]/p;else for(o=0;o<p;o++)a[2*o]/=p,a[2*o+1]/=p}function b(){this.reset.apply(this,arguments)}var e=l.sin,c=l.cos,d=2*l.PI;b.prototype={factors:null,scratch:null,bufferSize:2048,reset:function(a){this.bufferSize=isNaN(a)?
this.bufferSize:this.bufferSize;this.factors=[2,2,2,2,2,2,2,2,2,2];this.scratch=new s(this.bufferSize)},forward:function(b){a(b,this.scratch,this.factors,!0)},backward:function(b){a(b,this.scratch,this.factors,!1)}};return b}();(function(a){a.resetFFT=a.reset;a.reset=function(a,e){k.FourierTransform.apply(this,arguments);this.resetBuffer.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments);this.resetFFT.apply(this,[].slice.call(arguments,1))};a.process=function(a){this[this.method](a||
this.buffer);return this.calculateSpectrum()};a.sampleRate=44100;a.method="forward"})(m.prototype);this.FourierTransform=function(){function a(b,c){for(var d in a.prototype)a.prototype.hasOwnProperty&&(this[d]=a.prototype[d]);F.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments)}var b=l.sqrt;a.prototype={resetFT:function(a){this.sampleRate=isNaN(a)?this.sampleRate:a;this.bandWidth=0.5*2/this.bufferSize*this.sampleRate;this.spectrum=new s(0.5*this.bufferSize);this.peak=this.peakBand=
0},getBandFrequency:function(a){return this.bandwidth*a+0.5*this.bandWidth},calculateSpectrum:function(){var a=this.spectrum,c=2/this.bufferSize,d=this.bufferSize/2,h,g,j;for(j=0;j<d;j++){h=this.buffer[2*j];g=this.buffer[2*j+1];h=c*b(h*h+g*g);if(h>this.peak)this.peakBand=j,this.peak=h;a[j]=h}}};return a}();k.ADSREnvelope=Y;k.StepSequencer=Z;k.UIControl=$;k.BiquadFilter=p;k.BitCrusher=function(a,b){var e=this,c=0;e.sampleRate=a;e.resolution=b?l.pow(2,b-1):l.pow(2,7);e.pushSample=function(a){return c=
l.floor(a*e.resolution+0.5)/e.resolution};e.getMix=function(){return c}};k.Chorus=function(a,b,e,c){function d(){g=new s(0.1*h.sampleRate);j=0;var a,b=g.length;for(a=0;a<b;a++)g[a]=0}var h=this,g,j,k;h.delayTime=b||30;h.depth=e||3;h.freq=c||0.1;h.sampleRate=a;h.osc=new K(a,c);h.calcCoeff=d;h.pushSample=function(a){++j>=g.length&&(j=0);g[j]=a;h.osc.generate();a=h.delayTime+h.osc.getMix()*h.depth;a*=h.sampleRate/1E3;for(a=j-l.floor(a);0>a;)a+=g.length;return k=g[a]};h.getMix=function(){return k};d()};
k.CombFilter=aa;k.Compressor=function(a,b,e){var c=this,d=0;c.sampleRate=a;c.scale=b||1;c.gain=isNaN(e)?0.5:e;c.pushSample=function(a){a/=c.scale;return d=(1+c.gain)*a-c.gain*a*a*a};c.getMix=function(){return d}};k.Delay=J;k.Distortion=function(a){var b=new R(a,720.484),e=new R(a,723.431),c=new R(a,1),d=0;this.gain=4;this.master=1;this.sampleRate=a;this.filters=[b,e,c];this.pushSample=function(a){b.pushSample(a);d=b.getMix(1)*this.gain;d=l.atan(d)+d;0.4<d?d=0.4:-0.4>d&&(d=-0.4);e.pushSample(d);c.pushSample(e.getMix(0));
return d=c.getMix(1)*this.master};this.getMix=function(){return d}};k.GainController=ba;k.IIRFilter=R;k.LP12Filter=function(a,b,e){function c(){k=j*d.cutoff/d.samplerate;m=1-k/(2*(d.resonance+0.5/(1+k))+k-2);p=m*m;r=p+1-2*l.cos(k)*m}var d=this,h=0,g=0,j=2*l.PI,k,m,p,r,t,s;d.cutoff=!b?2E4:b;d.resonance=!e?1:e;d.samplerate=a;d.pushSample=function(a){if(t!==d.cutoff||s!==d.resonance)c(),t=d.cutoff,s=d.resonance;h+=(a-g)*r;g+=h;h*=p;return g};d.getMix=function(){return g};c()};k.Limiter=ca;k.Reverb=A;
k.ColorNoise=da;k.Oscillator=K;k.Sampler=ea;k.Amplitude=fa;k.FFT=m;k.AudioProcessingUnit=F;k.AudioDevice=k.Sink=function(){return this}().Sink;(function(a,b){function e(a){return new k.BufferEffect(this,a,[].slice.call(arguments,1))}function c(a,b,g,j){if(b){var g=g||b.prototype,k=b.prototype=new G;k.name=k.fxid=a;c[a]=T(a,b,j);c[a].createBufferBased=b.createBufferBased=e;for(j in g)g.hasOwnProperty(j)&&(k[j]=g[j])}return c[a]}k.effects=c;for(b=0;b<a.length;b++)k[a[b]]=c(a[b],k[a[b]],k[a[b]].prototype);
c("BiquadAllPassFilter",p.AllPass);c("BiquadBandPassFilter",p.BandPass);c("BiquadHighPassFilter",p.HighPass);c("BiquadLowPassFilter",p.LowPass);c("FreeverbAllPassFilter",A.AllPassFilter)})("BiquadFilter,BitCrusher,Chorus,CombFilter,Compressor,Delay,Distortion,GainController,IIRFilter,LP12Filter,Limiter,Reverb,Amplitude,FFT".split(","));(function(a,b){function e(a,b,h,g){if(b){var h=h||b.prototype,j=b.prototype=new V;j.name=j.fxid=a;e[a]=T(a,b,g);for(g in h)h.hasOwnProperty(g)&&(j[g]=h[g])}return e[a]}
k.generators=e;for(b=0;b<a.length;b++)k[a[b]]=e(a[b],k[a[b]],k[a[b]].prototype)})("ColorNoise,Oscillator,Sampler,ADSREnvelope,StepSequencer,UIControl".split(","));B("wav",k.PCMData);k.Automation=x;k.BufferEffect=X;k.EffectChain=E;k.EffectClass=G;k.GeneratorClass=V;k.codecs=k.Codec=B;k.plugins=H;k.version="0.5.2";k.BufferEffect.prototype.addAutomation=k.EffectClass.prototype.addAutomation=k.GeneratorClass.prototype.addAutomation=function(){return k.Automation.apply(k,[this].concat([].slice.call(arguments)))};
return k}.call("undefined"===typeof exports?{}:this,this.window||global,Math,Object,Array);
audioLib.Binaural=audioLib.generators("BinauralTone",function(q,m,l){this.frequency=isNaN(m)?440:m;this.spread=isNaN(l)?10:l;this.sampleRate=q},{sampleRate:44100,frequency:440,spread:10,phaseOffset:0,pulseWidth:0.5,fm:0,phase:[0,0],_p:[0,0],generate:function(){var q=[+this.frequency,+this.frequency+this.spread],m=this.pulseWidth,l=this.phase;q[0]+=q[0]*this.fm;q[1]+=q[1]*this.fm;this.phase[0]=(l[0]+q[0]/this.sampleRate/2)%1;this.phase[1]=(l[1]+q[1]/this.sampleRate/2)%1;l[0]=(this.phase[0]+this.phaseOffset)%
1;l[1]=(this.phase[1]+this.phaseOffset)%1;this._p[0]=l[0]<m?l[0]/m:(l[0]-m)/(1-m);this._p[1]=l[1]<m?l[1]/m:(l[1]-m)/(1-m)},getMix:function(q){return Math.sin(2*this._p[q]*Math.PI)}});var Noise=function(){var q=this;this.dev=audioLib.Sink(function(m,l){q.generateBuffer(m,l)},2);this.bufferSize=this.dev.bufferSize;this.sampleRate=this.dev.sampleRate;this.actualVolume=this.volume=100;this.sources=[]};
Noise.prototype={addSource:function(q,m){console.log("addSource called.");console.log('Adding sound source "'+q().name+'". Total: '+(this.sources.length+1));console.log(arguments);m?m.sampleRate=this.sampleRate:m={sampleRate:this.sampleRate};console.log(m);this.sources.push({volume:100,func:q(m)})},removeSource:function(q){console.log('Removing source "'+q().name+'".');this.sources.splice(this.sources.indexOf(q),1)},setVolume:function(q){this.volume=0>(100<q?100:q)?0:q;this.actualVolume=this.volume*
this.volume*this.volume/1E6},generateBuffer:function(q,m){for(var l=0;l<q.length;l+=m){for(var y=0;y<this.sources.length;y++){this.sources[y].generate();for(var r=0;r<m;r++)q[l+r]+=this.sources[y].getMix(r)}for(r=0;r<m;r++)q[l+r]*=this.actualVolume}}};
