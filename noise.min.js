this.audioLib=function AUDIOLIB(n,l,A,q){function p(f){f=new ga(f);f.subarray=f.subarray||f.slice;return f}function x(f,a,b,e){S?S(f,a,{get:function(){return b},enumerable:!!e}):f[a]=b}function W(f){var a=arguments,b=a.length,e,d;for(e=1;e<b;e++)for(d in a[e])a[e].hasOwnProperty(d)&&(f[d]=a[e][d]);return f}function T(f,a,b){var e;if(!b)if(b=[],e=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(a))e[1].replace(/[a-z$_0-9]+/ig,function(a){b.push(a)});else for(e=0;e<a.length;e++)b[e]=q(e+2).join("_");f=Function("var __q;return function "+
f+"("+b.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+f+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+f+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")();f.prototype=a.prototype;f.prototype.__CLASSCONSTRUCTOR=a;W(f,a);return f}function U(f,a,b,e){this.parameter=f;this.automation=a;this.amount=isNaN(b)?this.amount:b;this.setType(e)}function B(f,a,b,e,d){if(!f.automation)switch(f.automation=[],f.type){case "generator":f.append=B.generatorAppend;break;case "effect":f.append=
B.effectAppend;break;case "buffereffect":f.append=B.bufferEffectAppend}b=new U(a,b,e,d);f.automation.push(b);return b}function X(f,a,b){function e(){f.apply(this,b)}this.channelCount=isNaN(a)?this.channelCount:a;this.effects=[];for(e.prototype=f.prototype;a--;)this.effects.push(new e)}function C(f,a){var b=f[0].toUpperCase()+f.substr(1).toLowerCase();C[f]=a;a.decode&&(k.Sampler.prototype["load"+b]=function(a){this.load.apply(this,[C[f].decode(a)].concat([].slice.call(arguments,1)))});a.encode&&(k.AudioDevice.Recording.prototype["to"+
b]=function(a){return C[f].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:a})});return a}function F(){var f=q.prototype.splice.call(arguments,0),a=f.prototype=F.prototype;for(i in a)a.hasOwnProperty(i)&&(f[i]=a[i]);return f}function H(){}function V(){}function I(f,a){I[f]=a;I._pluginList.push({plugin:a,name:f})}function Y(f,a,b,e,d,c,h){this.sampleRate=isNaN(f)?this.sampleRate:f;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?
this.decay:b;this.sustain=isNaN(e)?this.sustain:e;this.release=isNaN(d)?this.release:d;this.sustainTime=isNaN(c)?null:c;this.releaseTime=isNaN(h)?null:h}function Z(f,a,b,e){this.sampleRate=isNaN(f)?this.sampleRate:f;this.stepLength=isNaN(a)?this.stepLength:a;this.steps=b||[1,0];this.attack=isNaN(e)?this.attack:e}function $(f,a){this.sampleRate=isNaN(f)?this.sampleRate:f;this.schedule=[];this.reset(a)}function u(f,a,b,e,d,c){this.reset.apply(this,arguments)}function aa(f,a,b,e){this.sampleRate=f;this.buffer=
new p(isNaN(a)?1200:a);this.bufferSize=this.buffer.length;this.feedback=isNaN(b)?this.feedback:b;this.damping=isNaN(e)?this.damping:e;this.invDamping=1-this.damping}function J(f,a,b){this.time=isNaN(a)?this.time:a;this.feedback=isNaN(b)?this.feedback:b;this.reset(f)}function y(f,a,b,e,d,c,h){var g=this;g.sampleRate=f;g.channelCount=isNaN(a)?g.channelCount:a;g.wet=isNaN(b)?g.wet:b;g.dry=isNaN(e)?g.dry:e;g.roomSize=isNaN(d)?g.roomSize:d;g.damping=isNaN(c)?g.damping:c;g.tuning=new y.Tuning(h||g.tuning);
g.sample=function(){var a=[],b;for(b=0;b<g.channelCount;b++)a[b]=0;return a}();g.CFs=function(){var a=[],b=[],c=g.tuning.combCount,d=g.damping*g.tuning.scaleDamping,e=g.roomSize*g.tuning.scaleRoom+g.tuning.offsetRoom,f=g.tuning.combTuning,h,l;for(l=0;l<g.channelCount;l++){for(h=0;h<c;h++)b.push(new k.CombFilter(g.sampleRate,f[h]+l*g.tuning.stereoSpread,e,d));a.push(b);b=[]}return a}();g.numCFs=g.CFs[0].length;g.APFs=function(){var a=[],b=[],c=g.tuning.allPassCount,d=g.tuning.allPassFeedback,e=g.tuning.allPassTuning,
f,h;for(h=0;h<g.channelCount;h++){for(f=0;f<c;f++)b.push(new y.AllPassFilter(g.sampleRate,e[f]+h*g.tuning.stereoSpread,d));a.push(b);b=[]}return a}();g.numAPFs=g.APFs[0].length}function ba(f,a){this.sampleRate=isNaN(f)?this.sampleRate:f;this.gain=isNaN(a)?this.gain:a}function R(f,a,b,e){var d=this,c=[0,0,0,0],h,g,j,m,D=l.sin,z=l.min,v=l.pow;d.cutoff=isNaN(a)?2E4:a;d.resonance=!b?0.1:b;d.samplerate=isNaN(f)?44100:sampleRate;d.type=e||0;d.pushSample=function(a){if(j!==d.cutoff||m!==d.resonance)h=2*
D(l.PI*z(0.25,d.cutoff/(2*d.samplerate))),g=z(2*(1-v(d.resonance,0.25)),z(2,2/h-0.5*h)),j=d.cutoff,m=d.resonance;c[3]=a-g*c[2];c[0]+=h*c[2];c[1]=c[3]-c[0];c[2]=h*c[1]+c[2];c[3]=a-g*c[2];c[0]+=h*c[2];c[1]=c[3]-c[0];c[2]=h*c[1]+c[2];return c[d.type]};d.getMix=function(a){return c[a||d.type]}}function ca(f,a,b,e){this.sampleRate=isNaN(f)?this.sampleRate:f;this.threshold=isNaN(a)?this.threshold:a;this.attack=isNaN(b)?this.attack:b;this.release=isNaN(e)?this.release:e;this._amplitude=new k.Amplitude(this.sampleRate,
this.attack,this.release)}function da(){this.reset.apply(this,arguments)}function K(f,a){this.frequency=isNaN(a)?440:a;this.waveTable=new p(1);this.sampleRate=f;this.waveShapes=this.waveShapes.slice(0)}function ea(f,a){this.voices=[];this.sampleRate=f;this.pitch=isNaN(a)?440:this.pitch}function fa(f,a,b){this.sampleRate=isNaN(f)?this.sampleRate:f;this.attack=isNaN(a)?this.attack:a;this.decay=isNaN(b)?this.decay:b}function G(f){for(var a in G.prototype)G.prototype.hasOwnProperty(a)&&(this[a]=G.prototype[a]);
this.resetBuffer.apply(this,arguments)}var ga=n.Float32Array||q,k=this;k.Float32Array=p;var S=function(){if(A.defineProperty)return A.defineProperty;if(A.prototype.__defineGetter__)return function(f,a,b){b.get&&f.__defineGetter__(a,b.get);b.set&&f.__defineSetter__(a,b.set)}}();x(k,"__define",S);x(k,"__defineConst",x);x(k,"__extend",W);x(k,"__enum",function(f,a,b){for(var e in f)(f.hasOwnProperty(e)||b)&&a.call(f,f[e],e);return f});x(k,"__class",T);U.prototype={parameter:"",automation:null,amount:1,
type:"modulation",mode:null,setType:function(f){if(f){if("function"===typeof f)this.type=f.name||"custom",this.mode=f;this.type=f;this.mode=B.modes[f]}else this.mode=this.mode||B.modes[this.type]}};B.generatorAppend=function(f,a,b){var e=f.length,d=this.automation.length,c=[],h,g,j,m,b=b||f,a=a||this.channelCount;for(j=0;j<d;j++)c.push(this[this.automation[j].parameter]);for(g=0,h=0;g<e;g+=a,h++){for(j=0;j<d;j++)this[this.automation[j].parameter]=c[j];for(j=0;j<d;j++)m=this.automation[j],m.mode(this,
m.parameter,m.amount*m.automation.generatedBuffer[h]);this.generate();for(j=0;j<a;j++)b[g+j]=this.getMix(j)*this.mix+f[g+j]}for(j=0;j<d;j++)this[this.automation[j].parameter]=c[j];return b};B.effectAppend=function(f,a,b){var e=f.length,d=this.automation.length,c=[],h,g,j,m,b=b||f,a=a||this.channelCount;for(j=0;j<d;j++)c.push(this[this.automation[j].parameter]);for(g=0,h=0;g<e;g+=a,h++){for(j=0;j<d;j++)this[this.automation[j].parameter]=c[j];for(j=0;j<d;j++)m=this.automation[j],m.mode(this,m.parameter,
m.amount*m.automation.generatedBuffer[h]);for(j=0;j<a;j++)this.pushSample(f[g+j],j),b[g+j]=this.getMix(j)*this.mix+f[g+j]*(1-this.mix)}for(j=0;j<d;j++)this[this.automation[j].parameter]=c[j];return b};B.bufferEffectAppend=function(f,a,b){var a=a||this.channelCount,e=f.length,d=this.automation.length,c=[],h,g,j,m,D,b=b||f;for(j=0;j<d;j++){c.push([]);for(g=0;g<a;g++)c[j].push(this.effects[g][this.automation[j].parameter])}for(D=0,h=0;h<e;h+=a,D++)for(g=0;g<a;g++){for(j=0;j<d;j++)m=this.automation[j],
this.effects[g][m.parameter]=c[j][g],m.mode(this.effects[g],m.parameter,m.amount*m.automation.generatedBuffer[D]);b[h+g]=this.effects[g].pushSample(f[h+g])*this.mix+f[h+g]*(1-this.mix)}for(j=0;j<d;j++)for(g=0;g<a;g++)this.effects[g][this.automation[j].parameter]=c[j][g];return b};B.modes={modulation:function(f,a,b){f.setParam(a,f[a]*b)},addition:function(f,a,b){f.setParam(a,f[a]+b)},subtraction:function(f,a,b){f.setParam(a,f[a]-b)},additiveModulation:function(f,a,b){f.setParam(a,f[a]+f[a]*b)},subtractiveModulation:function(f,
a,b){f.setParam(a,f[a]-f[a]*b)},assignment:function(f,a,b){f.setParam(a,b)},absoluteAssignment:function(f,a,b){f.setParam(a,l.abs(b))}};B.__constructror=U;X.prototype={mix:0.5,type:"buffereffect",channelCount:2,append:function(f,a,b){var e=f.length,d,c,a=a||this.channelCount,b=b||f;for(d=0;d<e;d+=a)for(c=0;c<a;c++)this.effects[c].pushSample(f[d+c],0),b[d+c]=this.effects[c].getMix(0)*this.mix+f[d+c]*(1-this.mix);return b},join:function(){return BufferEffectChain.apply(0,[this].concat(q.prototype.splice.call(arguments,
0)))},addPreProcessing:function(){var f;for(f=0;f<this.effects.length;f++)this.effects[f].addPreProcessing.apply(this.effects[f],arguments)},removePreProcessing:function(){var f;for(f=0;f<this.effects.length;f++)this.effects[f].removePreProcessing.apply(this.effects[f],arguments)},setParam:function(f,a){var b=this.effects.length,e;for(e=0;e<b;e++)this.effects[e].setParam(f,a)}};(function(f){F.prototype=f;f.pushSample=function(a){var b,e;for(e=0;e<this.length;e++)b=this[e].mix,a=this[e].pushSample(a)*
b+a*(1-b);return a}})(new H);H.prototype={type:"effect",sink:!0,source:!0,mix:0.5,channelCount:1,append:function(f,a,b){var e=f.length,d,c,b=b||f,a=a||this.channelCount;for(d=0;d<e;d+=a)for(c=0;c<a;c++)this.pushSample(f[d+c],c),b[d+c]=this.getMix(c)*this.mix+f[d+c]*(1-this.mix);return b},join:function(){return F.apply(0,[this].concat(q.prototype.splice.call(arguments,0)))},addPreProcessing:function(f){f.pushSample=this.pushSample;this.pushSample=function(){f.apply(this,arguments);return f.pushSample.apply(this,
arguments)}},removePreProcessing:function(f){for(var a;a=this.pushSample.pushSample;)if(a===f||!f)this.pushSample=a,f.pushSample=null},setParam:function(f,a){this[f]=a},pushSample:function(){},getMix:function(){},reset:function(){}};V.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(f,a,b){var e=f.length,d,c,b=b||f,a=a||this.channelCount;for(d=0;d<e;d+=a){this.generate();for(c=0;c<a;c++)b[d+c]=this.getMix(c)*this.mix+f[d+c]}return b},addPreProcessing:function(f){f.generate=
this.generate;this.generate=function(){f.apply(this,arguments);return f.generate.apply(this,arguments)}},removePreProcessing:function(f){for(var a;a=this.generate.generate;)if(a===f||!f)this.generate=a,f.generate=null},generateBuffer:function(f,a){this.generatedBuffer=new p(f);this.append(this.generatedBuffer,a||1)},setParam:function(f,a){this[f]=a},generate:function(){},getMix:function(){},reset:function(){}};x(I,"_pluginList",[],!1);Y.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,
sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){this.states[this.state].call(this);return this.value},getMix:function(){return this.value},triggerGate:function(f){this.state=(this.gate=f="undefined"===typeof f?!this.gate:f)?0:null===this.releaseTime?3:5;this._st=0},states:[function(){this.value+=1E3/this.sampleRate/this.attack;if(1<=this.value)this.state=1},function(){this.value-=1E3/this.sampleRate/this.decay*this.sustain;if(this.value<=this.sustain)null===this.sustainTime?
this.state=2:(this._st=0,this.state=4)},function(){this.value=this.sustain},function(){this.value=l.max(0,this.value-1E3/this.sampleRate/this.release)},function(){this.value=this.sustain;if(this._st++>=0.0010*this.sampleRate*this.sustainTime)this._st=0,this.state=null===this.releaseTime?3:5},function(){this.value=l.max(0,this.value-1E3/this.sampleRate/this.release);if(this._st++>=0.0010*this.sampleRate*this.releaseTime)this.state=this._st=0}]};Z.prototype={sampleRate:44100,stepLength:200,steps:null,
attack:0,phase:0,value:0,generate:function(){var f=this.steps,a=this.sampleRate/1E3*this.stepLength*f.length,b,e;this.phase=(this.phase+1)%a;b=this.phase/a*f.length;a=b%1;b=l.floor(b);e=f[b]-f[(b||f.length)-1];f=f[b];a<this.attack&&(f-=e-e/this.attack*a);return this.value=f},getMix:function(){return this.value},triggerGate:function(){this.phase=0}};$.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var f;for(f=0;f<this.schedule.length;f++)if(this.schedule[f].t--)this.value=
this.schedule[f].v,this.schedule.splice(f--,1)},setValue:function(f){this.schedule.push({v:f,t:~~((+new Date-this.clock)/1E3*this.sampleRate)})},reset:function(f){this.value=isNaN(f)?this.value:f;this.clock=+new Date}};u.BiquadFilterClass=function a(){for(var b in a.prototype)a.prototype.hasOwnProperty&&(this[b]=this[b])};u.BiquadFilterClass.prototype={sampleRate:44100,sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(a){var b=this.coefs,e=this.inputs,d=this.outputs;this.sample=b.b0*
a+b.b1*e[0]+b.b2*e[1]-b.a1*d[0]-b.a2*d[1];e.pop();e.unshift(a);d.pop();d.unshift(this.sample);return this.sample},getMix:function(){return this.sample},reset:function(a,b,e,d,c,h){this.inputs=[0,0];this.outputs=[0,0];this.sampleRate=isNaN(a)?this.sampleRate:a;if(1<arguments.length)this.coefs={b0:b,b1:e,b2:d,a1:c,a2:h}}};u.LowPass=function(a,b,e){var d=2*l.PI*b/a,b=l.cos(d),e=l.sin(d)/(2*e),d=(1-b)/2,c=1+e;this.reset(a,d/c,(1-b)/c,d/c,-2*b/c,(1-e)/c)};u.HighPass=function(a,b,e){var d=2*l.PI*b/a,b=
l.cos(d),e=l.sin(d)/(2*e),d=(1+b)/2,c=1+e;this.reset(a,d/c,-(1+b)/c,d/c,-2*b/c,(1-e)/c)};u.AllPass=function(a,b,e){var d=2*l.PI*b/a,b=l.cos(d),d=l.sin(d)/(2*e),e=1-d,b=-2*b,d=1+d;this.reset(a,e/d,b/d,d/d,b/d,e/d)};u.BandPass=function(a,b,e){var d=2*l.PI*b/a,b=l.cos(d),c=l.sin(d),e=l.log(2)/2*e*d/c,e=c*(l.exp(e)-l.exp(-e))/2,c=1+e;this.reset(a,e/c,0/c,-e/c,-2*b/c,(1-e)/c)};(function(a,b){for(b=0;b<a.length;b++)a[b].prototype=new u.BiquadFilterClass})([u,u.LowPass,u.HighPass,u.AllPass,u.BandPass]);
aa.prototype={sample:0,index:0,store:0,feedback:0.84,damping:0.2,pushSample:function(a){this.sample=this.buffer[this.index];this.store=this.sample*this.invDamping+this.store*this.damping;this.buffer[this.index++]=a+this.store*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},reset:function(){this.samples=this.index=this.store=0;this.buffer=new p(this.bufferSize)},setParam:function(a,b){switch(a){case "damping":this.damping=b;this.invDamping=
1-b;break;default:this[a]=b}}};J.prototype={sampleRate:1,time:1E3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(a){var b=this.buffer;b[this.bufferPos++]+=a;if(this.bufferPos>this.time*this._rstf)this.bufferPos=0;this.sample=b[this.bufferPos];b[this.bufferPos]*=this.feedback;return this.sample},getMix:function(){return this.sample},resample:function(a){var b=this.time/a;this.buffer=k.Sink.resample(this.buffer,a);this.time=a;this.bufferPos=l.round(b*this.bufferPos);return this.buffer},
reset:function(a,b){var e=this.buffer,d,a=isNaN(a)?this.sampleRate:a;d=this.sampleRate/a;this.buffer=new p(a*J.MAX_DELAY);this.bufferPos=l.round(d*this.bufferPos);this._rstf=0.0010*a;if(b){e=k.Sink.resample(e,d);for(d=0;d<e.length&&d<this.buffer.length;d++)this.buffer[d]=e[d]}return this.buffer}};J.MAX_DELAY=2;y.prototype={channelCount:2,sample:[0,0],wet:0.5,dry:0.55,damping:0.2223,roomSize:0.5,tuning:{},pushSample:function(a,b){var e=a*this.tuning.fixedGain,d=0,c;for(c=0;c<this.numCFs;c++)d+=this.CFs[b][c].pushSample(e);
for(c=0;c<this.numAPFs;c++)d=this.APFs[b][c].pushSample(d);this.sample[b]=d*this.wet+a*this.dry},getMix:function(a){return this.sample[a]},reset:function(){var a,b;for(b=0;b<this.channelCount;b++){for(a=0;a<this.numCFs;a++)this.CFs[b][a].reset();for(a=0;a<this.numAPFs;a++)this.APFs[b][a].reset();this.sample[b]=0}},setParam:function(a,b){var e,d,c;switch(a){case "roomSize":this.roomSize=b;e=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom;for(c=0;c<this.channelCount;c++)for(d=0;d<this.numCFs;d++)this.CFs[c][d].setParam("feedback",
e);break;case "damping":this.damping=b;e=this.damping*this.tuning.scaleDamping;for(c=0;c<this.channelCount;c++)for(d=0;d<this.numCFs;d++)this.CFs[c][d].setParam("damping",e);break;default:this[a]=b}}};y.Tuning=function(a){var b;if(a)for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};y.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:0.5,fixedGain:0.015,scaleDamping:0.9,scaleRoom:0.28,offsetRoom:0.7,stereoSpread:23};
y.AllPassFilter=function(a,b,e){this.sampleRate=a;this.buffer=new p(isNaN(b)?500:b);this.bufferSize=this.buffer.length;this.feedback=isNaN(e)?this.feedback:e};y.AllPassFilter.prototype={sample:0,index:0,feedback:0.5,pushSample:function(a){bufOut=this.buffer[this.index];this.sample=-a+bufOut;this.buffer[this.index++]=a+bufOut*this.feedback;if(this.index>=this.bufferSize)this.index=0;return this.sample},getMix:function(){return this.sample},reset:function(){this.sample=this.index=0;this.buffer=new p(this.bufferSize)}};
ba.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(a){return this.sample=a*this.gain},getMix:function(){return this.sample}};ca.prototype={sampleRate:44100,threshold:0.95,attack:0.01,release:0.01,__amplitude:null,sample:0,pushSample:function(a){var b=this._amplitude.pushSample(a)-this.threshold;return this.sample=0<b?a/(1+b):a},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case "attack":case "release":this._amplitude[a]=b;default:this[a]=b}}};da.prototype=
{sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a;this.color="string"===typeof b?b:this.color;this.c1=(1<<this.q)-1;this.c2=~~(this.c1/3)+1;this.c3=1/this.c1;this.c1=6*this.c2;this.c4=3*(this.c2-1);this.q0=l.exp(-200*l.PI/this.sampleRate);this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},white:function(){return(l.random()*
this.c1-this.c4)*this.c3},pink:function(){var a=this.white();this.b0=0.997*this.b0+0.029591*a;this.b1=0.985*this.b1+0.032534*a;this.b2=0.95*this.b2+0.048056*a;this.b3=0.85*this.b3+0.090579*a;this.b4=0.62*this.b4+0.10899*a;this.b5=0.25*this.b5+0.255784*a;return 0.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){this.brownQ=this.q1*this.white()+this.q0*this.brownQ;return 6.2*this.brownQ}};(function(a,b,e,d){e=K.prototype={sampleRate:44100,frequency:440,phaseOffset:0,pulseWidth:0.5,
fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var a=+this.frequency,b=this.pulseWidth,d=this.phase,a=a+a*this.fm;this.phase=(d+a/this.sampleRate/2)%1;d=(this.phase+this.phaseOffset)%1;this._p=d<b?d/b:(d-b)/(1-b)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(a){this.phase=this._p=isNaN(a)?0:a},setWavetable:function(a){this.waveTable=a;return!0},sine:function(){return l.sin(this._p*a)},triangle:function(){return 0.5>this._p?4*this._p-1:
3-4*this._p},square:function(){return 0.5>this._p?-1:1},sawtooth:function(){return 1-2*this._p},invSawtooth:function(){return 2*this._p-1},pulse:function(){return 0.5>this._p?0.25>this._p?8*this._p-1:1-8*(this._p-0.25):-1},wavetable:function(){return k.Sink.interpolate(this.wavetable,this._p*this.wavetable.length)},waveShapes:[]};for(d=0;d<b.length;d++)e[d]=e[b[d]],e.waveShapes.push(e[d]);K.WaveShape=function(a,b){b&&(this.prototype[a]=b);return this.prototype[a]};K.createMixWave=function(a,b){var d=
b.length,e,m;return this.WaveShape(a,function(){for(m=e=0;m<d;m++)e+=this[b[m].shape]()*b[m].mix;return e})}})(2*l.PI,"sine,triangle,pulse,sawtooth,invSawtooth,square".split(","));ea.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(a,b){var a=isNaN(a)?this.pitch:a,e=this.sampleRate,d=this.sampleSize-e*this.delayEnd-1,e={f:a,p:e*this.delayStart,s:a/this.pitch,l:d,v:isNaN(b)?1:b};for(this.voices.push(e);this.voices.length>
this.maxVoices;)d=this.voices.shift(),d.onend&&d.onend();return e},generate:function(){var a=this.voices,b,e;for(b=0;b<a.length;b++)e=a[b],e.p+=e.s,e.p>e.l&&a.splice(b--,1)&&e.onend&&e.onend()},getMix:function(a){var b=this.voices,e=0,d,a=a||0;if(this.samples[a])for(d=0;d<b.length;d++)e+=k.Sink.interpolate(this.samples[a],b[d].p)*b[d].v;return e},load:function(a,b){var e=this.samples=k.Sink.deinterleave(a.data,a.channelCount),d;if(b)for(d=0;d<e.length;d++)e[d]=k.Sink.resample(e[d],a.sampleRate,this.sampleRate);
this.sample=a.data;this.samples=e;this.data=a;this.sampleSize=e[0].length}};(function(){function a(){var a=arguments,e=a.length,d,c;for(c=0;c<e;c++)d=a[c],this.postMessage({type:"injection",code:d instanceof Function?"("+d+").call(this);":d})}k.AudioWorker=function(b,e){var d=new (window.MozBlobBuilder||window.BlobBuilder),c,h;d.append("var audioLib = ("+AUDIOLIB+"(this, Math, Object, Array));\n");for(c=0;c<k.plugins._pluginList.length;c++)d.append("("+k.plugins._pluginList[c]+"());\n");e&&d.append('this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)}, true);\n');
d.append(b instanceof Function?"("+b+").call(this);":b);c=window.URL.createObjectURL(d.getBlob());h=new Worker(c);h._terminate=h.terminate;h.terminate=function(){window.URL.revokeObjectURL(id);return h._terminate.call(h,arguments)};if(e)h.inject=a;return h}})();(function(a,b){function e(a,b){return b?h(a&255)+e(a>>8,b-1):""}function d(a,b){return b?d(a>>8,b-1)+h(255-a&255):""}function c(a,d,m,e){var h=b.pow,v=b.floor,r=c.convertFromBinary,E=c.convertToBinary,l=a/8,k=h(2,a),o=k/2,w=o-1,O=1/o,p=1/w;
return e?m?d?function(a,b){a=v(0>a?a*o+k:a*w);return E(a,l,b)}:function(a,b){return E(v(a*w),l,b)}:d?function(a,b){return E(0>a?a+k:a,l,b)}:function(a,b){return E(a,l,b)}:m?d?function(a,b){var d=r(a,b);return d>w?(d-k)*O:d*p}:function(a,b){return r(a,b)*p}:d?function(a,b){var d=r(a,b);return d>w?d-k:d}:function(a,b){return r(a,b)}}var h=String.fromCharCode;c.convertToBinary=function(a,b,c){return c?d(a,b):e(a,b)};c.convertFromBinary=function(a,d){var c=a.length,e=c-1,h=0,v=b.pow,r;if(d)for(r=0;r<
c;r++)h+=(255-a.charCodeAt(r))*v(256,e-r);else for(r=0;r<c;r++)h+=a.charCodeAt(r)*v(256,r);return h};c.fromQ32=c(32,!0,!0,!0);c.toQ32=c(32,!0,!0,!1);c.fromQ24=c(24,!0,!0,!0);c.toQ24=c(24,!0,!0,!1);c.fromQ16=c(16,!0,!0,!0);c.toQ16=c(16,!0,!0,!1);c.fromQ8=c(8,!0,!0,!0);c.toQ8=c(8,!0,!0,!1);c.fromInt32=c(32,!0,!1,!0);c.toInt32=c(32,!0,!1,!1);c.fromInt16=c(16,!0,!1,!0);c.toInt16=c(16,!0,!1,!1);c.fromInt8=c(8,!0,!1,!0);c.toInt8=c(8,!0,!1,!1);c.fromUint32=c(32,!1,!1,!0);c.toUint32=c(32,!1,!1,!1);c.fromUint16=
c(16,!1,!1,!0);c.toUint16=c(16,!1,!1,!1);c.fromUint8=c(8,!1,!1,!0);c.toUint8=c(8,!1,!1,!1);a.Binary=c})(this,l);(function(a,b){function e(a){this.data=a}function d(a,b,d){var e=b/8;c["read"+a+b]=function(a){return d(this.read(e),a)}}var c=e.prototype={read:function(a){var b=this.data.substr(0,a);this.skip(a);return b},skip:function(a){var b=this.data=this.data.substr(a);this.pointer+=a;return b.length},readBuffer:function(a,b,d){for(var b="read"+d+b,d=a.length,c=0;this.data&&c<d;)a[c++]=this[b]();
return c}},h,g;for(h in b)(g=/to([a-z]+)([0-9]+)/i.exec(h))&&d(g[1],g[2],b[h]);a.Stream=e;e.newType=d})(this,this.Binary);this.PCMData=function(a,b){function e(a){return("string"===typeof a?e.decode:e.encode)(a)}e.decodeFrame=function(a,c,e){if(8===c){var g=new (window.Uint8Array||q)(e.length);(new b(a)).readBuffer(g,8,"Uint");for(c=0;c<e.length;c++)e[c]=127.5*(g[c]-127.5)}else(new b(a)).readBuffer(e,c,"Q");return e};e.encodeFrame=function(b,c){var e=a[(8===c?"fromUint":"fromQ")+c],g=b.length,j="",
m;if(8===c)for(m=0;m<g;m++)j+=e(127.5*b[m]+127.5);else for(m=0;m<g;m++)j+=e(b[m]);return j};e.decode=function(a,c){function h(){r=g.read(4);E=g.readUint32();k=g.read(E);w=O[r]=O[r]||[];"data"===r?(l=~~(E/v),o=n.data=new ("undefined"!==typeof p?p:q)(l),e.decodeFrame(k,8*v,o)):w.push(k);c&&(g.data?setTimeout(h,1):c(n))}var g=new b(a);g.read(4);var j=g.readUint32(),g=new b(g.read(j));g.read(4);g.read(4);j=g.readUint32();j=new b(g.read(j));j.readUint16();var m=j.readUint16();j.readUint32();var D=j.readUint32(),
z=j.readUint16(),v=z/m;j.readUint16();var r,E,l,k,o,w,O={},n={channelCount:m,bytesPerSample:z/m,sampleRate:D/z,chunks:O,data:o};if(c)g.data?h():c(n);else for(;g.data;)h();return n};e.encode=function(b,c){var h=a.fromUint32,g=a.fromUint16,j=b.data,m=b.sampleRate,D=b.channelCount||1,z=b.bytesPerSample||1,v=8*z,r=D*z,E=m*r,k=j.length*z;l.pow(2,v-1);var t=[],z="",o;t.push("fmt "+h(16)+g(1)+g(D)+h(m)+h(E)+g(r)+g(v));t.push("data"+h(k)+e.encodeFrame(j,v));if(m=b.chunks)for(o in m)if(m.hasOwnProperty(o)){g=
m[o];for(j=0;j<g.length;j++)z=g[j],t.push(o+h(z.length)+z)}t=t.join("");t="RIFF"+h(t.length)+"WAVE"+t;c&&setTimeout(function(){c(t)},1);return t};return e}(this.Binary,this.Stream);(function(a){function b(a,c,d,e){var g=b.sinks,h;for(h in g)if(g.hasOwnProperty(h)&&g[h].enabled)try{return new g[h](a,c,d,e)}catch(j){}throw b.Error(2);}function e(){for(var a in e.prototype)e.prototype.hasOwnProperty(a)&&(this[a]=e.prototype[a]);this._listeners={}}function d(a){if(!d.hasOwnProperty(a))throw d(1);if(!(this instanceof
d))return new d(a);for(var b in d[a])d[a].hasOwnProperty(b)&&(this[b]=d[a][b]);this.code=a}function c(a){this.boundTo=a;this.buffers=[];a.activeRecordings.push(this)}function h(){}function g(a,c,d,e){d=d||c.prototype;c.prototype=new b.SinkClass;c.prototype.type=a;c.enabled=!e;for(e in d)d.hasOwnProperty(e)&&(c.prototype[e]=d[e]);g[a]=c}e.prototype={_listeners:null,emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b);return this},
on:function(a,b){this._listeners[a]=this._listeners[a]||[];this._listeners[a].push(b);return this},off:function(a,b){if(this._listeners[a]){if(!b)return delete this._listeners[a],this;for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c]===b&&this._listeners[a].splice(c--,1);this._listeners[a].length||delete this._listeners[a]}return this}};b.EventEmitter=e;d.prototype=Error();d.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message};d[1]={message:"No such error code.",
explanation:"The error code does not exist."};d[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."};d[16]={message:"Buffer underflow.",explanation:"Trying to recover..."};d[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."};d[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."};
b.Error=d;c.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,c=this.buffers,d,e,g=c.length;for(e=0;e<g;e++)a+=c[e].length;a=new p(a);for(e=0;e<g;e++){for(d=0;d<c[e].length;d++)a[b+d]=c[e][d];b+=c[e].length}return a}};b.SinkClass=h;h.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,writeMode:"async",channelMode:"interleaved",
previousHit:0,ringBuffer:null,ringOffset:0,start:function(a,c,d,e){this.channelCount=isNaN(c)||null===c?this.channelCount:c;this.bufferSize=isNaN(d)||null===d?this.bufferSize:d;this.sampleRate=isNaN(e)||null===e?this.sampleRate:e;this.readFn=a;this.activeRecordings=[];this.previousHit=+new Date;this.asyncBuffers=[];this.syncBuffers=[];b.EventEmitter.call(this)},process:function(a,c){this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);this.writeBuffersSync.apply(this,
arguments);if("interleaved"===this.channelMode)this.readFn&&this.readFn.apply(this,arguments),this.emit("audioprocess",arguments);else{var d=b.deinterleave(a,this.channelCount),e=[d].concat([].slice.call(arguments,1));this.readFn&&this.readFn.apply(this,e);this.emit("audioprocess",e);b.interleave(d,this.channelCount,a)}this.writeBuffersAsync.apply(this,arguments);this.recordData.apply(this,arguments);this.previousHit=+new Date;this.writePosition+=a.length/c},record:function(){return new c(this)},
recordData:function(a){var b=this.activeRecordings,c,d=b.length;for(c=0;c<d;c++)b[c].add(a)},writeBuffersAsync:function(a){var b=this.asyncBuffers,c=a.length,d,e,g,h,j;if(b)for(g=0;g<b.length;g++){d=b[g];e=d.b.length;j=d.d;d.d-=l.min(j,c);for(h=0;h+j<c&&h<e;h++)a[h+j]+=d.b[h];d.b=d.b.subarray(h+j);g>=e&&b.splice(g--,1)}},writeBuffersSync:function(a){for(var b=this.syncBuffers,c=a.length,d=0,e=0;d<c&&b.length;d++)a[d]+=b[0][e],b[0].length<=e?(b.splice(0,1),e=0):e++;b.length&&(b[0]=b[0].subarray(e))},
writeBufferAsync:function(a,c){var a="deinterleaved"===this.mode?b.interleave(a,this.channelCount):a,d=this.asyncBuffers;d.push({b:a,d:isNaN(c)?~~((+new Date-this.previousHit)/1E3*this.sampleRate):c});return d.length},writeBufferSync:function(a){var a="deinterleaved"===this.mode?b.interleave(a,this.channelCount):a,c=this.syncBuffers;c.push(a);return c.length},writeBuffer:function(){return this["async"===this.writeMode?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},getSyncWriteOffset:function(){var a=
this.syncBuffers,b=0,c;for(c=0;c<a.length;c++)b+=a[c].length;return b},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ringSpin:function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=this.ringOffset,g;for(g=0;g<c;g++)a[g]+=b[e],e=(e+1)%d;this.ringOffset=e},ringSpinDeinterleaved:function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=b[0].length,g=this.ringOffset,h,j;for(h=0;h<c;h+=d){for(j=0;j<d;j++)a[h+j]+=b[j][g];g=(g+1)%e}this.ringOffset=j}};g("moz",function(){function a(){if(e){h=
g.mozWriteAudio(e);d+=h;if(h<e.length)return e=e.subarray(h);e=null}j=g.mozCurrentSampleOffset();l=Number(j+(w!==j?c.bufferSize:c.preBufferSize)*c.channelCount-d);j===w&&c.emit("error",[b.Error(16)]);if(0<l||w===j){try{k=new p(w===j?c.preBufferSize*c.channelCount:l)}catch(m){c.emit("error",[b.Error(18)]);c.kill();return}c.process(k,c.channelCount);h=c._audio.mozWriteAudio(k);h<k.length&&(e=k.subarray(h));d+=h}w=j}var c=this,d=0,e=null,g=new Audio,h,j,l,k,w;c.start.apply(c,arguments);c.preBufferSize=
isNaN(arguments[4])||null===arguments[4]?this.preBufferSize:arguments[4];g.mozSetup(c.channelCount,c.sampleRate);this._timers=[];this._timers.push(b.doInterval(function(){if(2E3<+new Date-c.previousHit)c._audio=g=new Audio,g.mozSetup(c.channelCount,c.sampleRate),d=0,c.emit("error",[b.Error(17)])},1E3));this._timers.push(b.doInterval(a,20));c._bufferFill=a;c._audio=g},{bufferSize:24576,preBufferSize:24576,kill:function(){for(;this._timers.length;)this._timers[0](),this._timers.splice(0,1);this.emit("kill")},
getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}});var j=[];g("webkit",function(a,c,d,e){function h(a){var b=a.outputBuffer,a=b.numberOfChannels,c,d=b.length,e=new q(a),g=new p(d*a);for(c=0;c<a;c++)e[c]=b.getChannelData(c);k.process(g,k.channelCount);for(c=0;c<d;c++)for(b=0;b<a;b++)e[b][c]=g[c*k.channelCount+b]}var k=this,n=new (window.AudioContext||webkitAudioContext),t=n.createJavaScriptNode(d,0,c);k.start.apply(k,arguments);g.webkit.forceSampleRate&&k.sampleRate!==
n.sampleRate?h=function(a){var c=a.outputBuffer,a=c.numberOfChannels,d,e=c.length,g=new q(a),h=new p(l.floor(e*k.sampleRate/n.sampleRate)*a),j;for(d=0;d<a;d++)g[d]=c.getChannelData(d);k.process(h,k.channelCount);h=b.deinterleave(h,k.channelCount);for(c=0;c<a;c++){j=b.resample(h[c],k.sampleRate,n.sampleRate);for(d=0;d<e;d++)g[c][d]=j[d]}}:k.sampleRate=n.sampleRate;t.onaudioprocess=h;t.connect(n.destination);k._context=n;k._node=t;k._callback=h;j.push(t)},{kill:function(){this._node.disconnect(0);for(var a=
0;a<j.length;a++)j[a]===this._node&&j.splice(a--,1);this._node=this._context=null;this.kill();this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}});g.webkit.fix82795=j;g("dummy",function(){function a(){var b=new p(c.bufferSize*c.channelCount);c.process(b,c.channelCount)}var c=this;c.start.apply(c,arguments);c._kill=b.doInterval(a,1E3*(c.bufferSize/c.sampleRate));c._callback=a},{kill:function(){this._kill();this.emit("kill")}},!0);b.sinks=b.devices=g;b.Recording=
c;(function(){function a(b){var e=null,g,h;try{return h=new c,h.append(b),g=d.createObjectURL(h.getBlob()),e=new Worker(g),e._terminate=e.terminate,e._url=g,h=null,e.terminate=function(){d.revokeObjectURL(this._url)},a.type="blob",e}catch(j){}try{return e=new Worker("data:text/javascript;base64,"+btoa(b)),a.type="data",e}catch(k){}return e}var c="undefined"===typeof window?void 0:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,d="undefined"===
typeof window?void 0:window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL;a.ready=a.working=!1;b.EventEmitter.call(a);a.test=function(){function b(c){if(!a.ready)a.ready=!0,a.working=c,a.emit("ready",[c]),a.off("ready")}var c=a("this.onmessage=function(e){postMessage(e.data)}");a.ready=a.working=!1;c?(c.onmessage=function(a){b("inlineWorker"===a.data)},c.postMessage("inlineWorker"),setTimeout(function(){b(!1)},1E3)):b(!1)};b.inlineWorker=a;a.test()})();b.doInterval=function(a,c){function d(h){b.inlineWorker.working&&
!h?(e=b.inlineWorker('setInterval(function(){ postMessage("tic"); }, '+c+");"),e.onmessage=function(){a()},g=function(){e.terminate()}):(e=setInterval(a,c),g=function(){clearInterval(e)})}var e,g;b.doInterval.backgroundWork||b.devices.moz.backgroundWork?b.inlineWorker.ready?d():b.inlineWorker.on("ready",function(){d()}):d(!0);return function(){g?g():b.inlineWorker.ready||b.inlineWorker.on("ready",function(){g&&g()})}};b.doInterval.backgroundWork=!0;(function(){function a(c,d){if(c&&d)a[c]=d;else if(c&&
a[c]instanceof Function)b.interpolate=a[c];return a[c]}b.interpolation=a;a("linear",function(a,b){var c=l.floor(b),d=c+1,e=b-c,d=d<a.length?d:0;return a[c]*(1-e)+a[d]*e});a("nearest",function(a,b){return b>=a.length-0.5?a[0]:a[l.round(b)]});a("linear")})();b.resample=function(a,c,d,e,g){var h=arguments.length,h=2===h?c:3===h?c/d:e/c*g/d,j=a.length,k=l.ceil(j/h),k=new p(k),o,n;for(o=0,n=0;o<j;o+=h)k[n++]=b.interpolate(a,o);return k};b.deinterleave=function(a,b){var c=a.length/b,d=[],e,g;for(e=0;e<
b;e++){d[e]=new p(c);for(g=0;g<c;g++)d[e][g]=a[g*b+e]}return d};b.interleave=function(a,b,c){var b=b||a.length,d=a[0].length,e=a.length,g,h,c=c||new p(d*b);for(g=0;g<e;g++)for(h=0;h<d;h++)c[g+h*b]=a[g][h];return c};b.mix=function(a){var b=[].slice.call(arguments,1),c,d,e;for(e=0;e<b.length;e++){c=l.max(a.length,b[e].length);for(d=0;d<c;d++)a[d]+=b[e][d]}return a};b.resetBuffer=function(a){var b=a.length,c;for(c=0;c<b;c++)a[c]=0;return a};b.clone=function(a,b){var c=a.length,d,b=b||new p(c);for(d=
0;d<c;d++)b[d]=a[d];return b};b.createDeinterleaved=function(a,b){var c=new q(b),d;for(d=0;d<b;d++)c[d]=new p(a);return c};a.Sink=b})(function(){return this}());fa.prototype={sampleRate:44100,attack:0.01,release:0.01,sample:0,pushSample:function(a){return this.sample=l.abs((a>this.sample?this.attack:this.release)*(this.sample-a)+a)},getMix:function(){return this.sample}};G.prototype={bufferPos:-1,pushSample:function(a){this.bufferPos=(this.bufferPos+1)%this.buffer.length;0===this.bufferPos&&this.process(this.buffer);
return this.buffer[this.bufferPos]=a},getMix:function(){return this.buffer[this.bufferPos]},resetBuffer:function(a){this.bufferSize=isNaN(a)?this.bufferSize:a;this.buffer=new p(this.bufferSize);this.bufferPos=-1}};n=function(){function a(a,b,j,k){var l=1,n=0,v=0.5*a.length,r=j.length,q,u,t,o;for(o=0;o<r;o++)if(t=j[o],l*=t,0===n?(q=a,u=b,n=1):(q=b,u=a,n=0),2===t){t=q;for(var w=u,B=k,y=0.5*t.length,A=0,x=0,G=y/2,y=y/l,C=l/2,K=1*C,P=new p(2),F=void 0,N=void 0,L=void 0,M=void 0,H=void 0,I=void 0,Q=void 0,
J=void 0,M=L=void 0,F=0;F<y;F++,x+=K){N=P;Q=(B?c:-c)*F/(2*y);N[0]=d(Q);N[1]=e(Q);for(N=0;N<C;N++,A++,x++)L=t[2*A],M=t[2*A+1],H=t[2*(A+G)],I=t[2*(A+G)+1],Q=L+H,J=M+I,L-=H,M-=I,w[2*x]=Q,w[2*x+1]=J,w[2*(x+C)]=P[0]*L-P[1]*M,w[2*(x+C)+1]=P[0]*M+P[1]*L}}if(k){if(1===n)for(o=0;o<v;o++)a[2*o]=b[2*o],a[2*o+1]=b[2*o+1]}else if(1===n)for(o=0;o<v;o++)a[2*o]=b[2*o]/v,a[2*o+1]=b[2*o+1]/v;else for(o=0;o<v;o++)a[2*o]/=v,a[2*o+1]/=v}function b(){this.reset.apply(this,arguments)}var e=l.sin,d=l.cos,c=2*l.PI;b.prototype=
{factors:null,scratch:null,bufferSize:2048,reset:function(a){this.bufferSize=isNaN(a)?this.bufferSize:this.bufferSize;this.factors=[2,2,2,2,2,2,2,2,2,2];this.scratch=new p(this.bufferSize)},forward:function(b){a(b,this.scratch,this.factors,!0)},backward:function(b){a(b,this.scratch,this.factors,!1)}};return b}();(function(a){a.resetFFT=a.reset;a.reset=function(a,e){k.FourierTransform.apply(this,arguments);this.resetBuffer.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments);this.resetFFT.apply(this,
[].slice.call(arguments,1))};a.process=function(a){this[this.method](a||this.buffer);return this.calculateSpectrum()};a.sampleRate=44100;a.method="forward"})(n.prototype);this.FourierTransform=function(){function a(b,d){for(var c in a.prototype)a.prototype.hasOwnProperty&&(this[c]=a.prototype[c]);G.apply(this,[].slice.call(arguments,1));this.resetFT.apply(this,arguments)}var b=l.sqrt;a.prototype={resetFT:function(a){this.sampleRate=isNaN(a)?this.sampleRate:a;this.bandWidth=0.5*2/this.bufferSize*this.sampleRate;
this.spectrum=new p(0.5*this.bufferSize);this.peak=this.peakBand=0},getBandFrequency:function(a){return this.bandwidth*a+0.5*this.bandWidth},calculateSpectrum:function(){var a=this.spectrum,d=2/this.bufferSize,c=this.bufferSize/2,h,g,j;for(j=0;j<c;j++){h=this.buffer[2*j];g=this.buffer[2*j+1];h=d*b(h*h+g*g);if(h>this.peak)this.peakBand=j,this.peak=h;a[j]=h}}};return a}();k.ADSREnvelope=Y;k.StepSequencer=Z;k.UIControl=$;k.BiquadFilter=u;k.BitCrusher=function(a,b){var e=this,d=0;e.sampleRate=a;e.resolution=
b?l.pow(2,b-1):l.pow(2,7);e.pushSample=function(a){return d=l.floor(a*e.resolution+0.5)/e.resolution};e.getMix=function(){return d}};k.Chorus=function(a,b,e,d){function c(){g=new p(0.1*h.sampleRate);j=0;var a,b=g.length;for(a=0;a<b;a++)g[a]=0}var h=this,g,j,k;h.delayTime=b||30;h.depth=e||3;h.freq=d||0.1;h.sampleRate=a;h.osc=new K(a,d);h.calcCoeff=c;h.pushSample=function(a){++j>=g.length&&(j=0);g[j]=a;h.osc.generate();a=h.delayTime+h.osc.getMix()*h.depth;a*=h.sampleRate/1E3;for(a=j-l.floor(a);0>a;)a+=
g.length;return k=g[a]};h.getMix=function(){return k};c()};k.CombFilter=aa;k.Compressor=function(a,b,e){var d=this,c=0;d.sampleRate=a;d.scale=b||1;d.gain=isNaN(e)?0.5:e;d.pushSample=function(a){a/=d.scale;return c=(1+d.gain)*a-d.gain*a*a*a};d.getMix=function(){return c}};k.Delay=J;k.Distortion=function(a){var b=new R(a,720.484),e=new R(a,723.431),d=new R(a,1),c=0;this.gain=4;this.master=1;this.sampleRate=a;this.filters=[b,e,d];this.pushSample=function(a){b.pushSample(a);c=b.getMix(1)*this.gain;c=
l.atan(c)+c;0.4<c?c=0.4:-0.4>c&&(c=-0.4);e.pushSample(c);d.pushSample(e.getMix(0));return c=d.getMix(1)*this.master};this.getMix=function(){return c}};k.GainController=ba;k.IIRFilter=R;k.LP12Filter=function(a,b,e){function d(){k=j*c.cutoff/c.samplerate;n=1-k/(2*(c.resonance+0.5/(1+k))+k-2);p=n*n;q=p+1-2*l.cos(k)*n}var c=this,h=0,g=0,j=2*l.PI,k,n,p,q,r,u;c.cutoff=!b?2E4:b;c.resonance=!e?1:e;c.samplerate=a;c.pushSample=function(a){if(r!==c.cutoff||u!==c.resonance)d(),r=c.cutoff,u=c.resonance;h+=(a-
g)*q;g+=h;h*=p;return g};c.getMix=function(){return g};d()};k.Limiter=ca;k.Reverb=y;k.Noise=da;k.Oscillator=K;k.Sampler=ea;k.Amplitude=fa;k.FFT=n;k.AudioProcessingUnit=G;k.AudioDevice=k.Sink=function(){return this}().Sink;(function(a,b){function e(a){return new k.BufferEffect(this,a,[].slice.call(arguments,1))}function d(a,b,g,j){if(b){var g=g||b.prototype,k=b.prototype=new H;k.name=k.fxid=a;d[a]=T(a,b,j);d[a].createBufferBased=b.createBufferBased=e;for(j in g)g.hasOwnProperty(j)&&(k[j]=g[j])}return d[a]}
k.effects=d;for(b=0;b<a.length;b++)k[a[b]]=d(a[b],k[a[b]],k[a[b]].prototype);d("BiquadAllPassFilter",u.AllPass);d("BiquadBandPassFilter",u.BandPass);d("BiquadHighPassFilter",u.HighPass);d("BiquadLowPassFilter",u.LowPass);d("FreeverbAllPassFilter",y.AllPassFilter)})("BiquadFilter,BitCrusher,Chorus,CombFilter,Compressor,Delay,Distortion,GainController,IIRFilter,LP12Filter,Limiter,Reverb,Amplitude,FFT".split(","));(function(a,b){function e(a,b,h,g){if(b){var h=h||b.prototype,j=b.prototype=new V;j.name=
j.fxid=a;e[a]=T(a,b,g);for(g in h)h.hasOwnProperty(g)&&(j[g]=h[g])}return e[a]}k.generators=e;for(b=0;b<a.length;b++)k[a[b]]=e(a[b],k[a[b]],k[a[b]].prototype)})("Noise,Oscillator,Sampler,ADSREnvelope,StepSequencer,UIControl".split(","));C("wav",k.PCMData);k.Automation=B;k.BufferEffect=X;k.EffectChain=F;k.EffectClass=H;k.GeneratorClass=V;k.codecs=k.Codec=C;k.plugins=I;k.version="0.5.2";k.BufferEffect.prototype.addAutomation=k.EffectClass.prototype.addAutomation=k.GeneratorClass.prototype.addAutomation=
function(){return k.Automation.apply(k,[this].concat([].slice.call(arguments)))};return k}.call("undefined"===typeof exports?{}:this,this.window||global,Math,Object,Array);var Noise=function(){var s=this;this.active=!1;this.dev=audioLib.Sink(function(n,l){s.generateBuffer(n,l)},2);this.bufferSize=this.dev.bufferSize;this.sampleRate=this.dev.sampleRate;this.limiter=audioLib.Limiter(this.sampleRate);this.actualVolume=this.volume=100;this.sources=[]};
Noise.prototype={addSource:function(s){console.log('Adding sound source "'+s().name+'". Total: '+(this.sources.length+1));console.log(arguments);this.sources.push(s(this.sampleRate,arguments[1],arguments[2],arguments[3]))},removeSource:function(s){console.log('Removing source "'+s().name+'".');this.sources.splice(this.sources.indexOf(s),1)},setVolume:function(s){this.volume=s;this.actualVolume=this.volume*this.volume*this.volume/1E6},generateBuffer:function(s,n){for(var l=0;l<s.length;l+=n){for(var A=
0;A<this.sources.length;A++){this.sources[A].generate();for(var q=0;q<n;q++)s[l+q]+=this.sources[A].getMix(q)}for(q=0;q<n;q++)s[l+q]*=this.actualVolume}}};
audioLib.Binaural=audioLib.generators("BinauralTone",function(s,n,l){this.frequency=isNaN(n)?440:n;this.spread=isNaN(l)?10:l;this.sampleRate=s},{sampleRate:44100,frequency:440,spread:10,phaseOffset:0,pulseWidth:0.5,fm:0,phase:[0,0],_p:[0,0],generate:function(){var s=[+this.frequency,+this.frequency+this.spread],n=this.pulseWidth,l=this.phase;s[0]+=s[0]*this.fm;s[1]+=s[1]*this.fm;this.phase[0]=(l[0]+s[0]/this.sampleRate/2)%1;this.phase[1]=(l[1]+s[1]/this.sampleRate/2)%1;l[0]=(this.phase[0]+this.phaseOffset)%
1;l[1]=(this.phase[1]+this.phaseOffset)%1;this._p[0]=l[0]<n?l[0]/n:(l[0]-n)/(1-n);this._p[1]=l[1]<n?l[1]/n:(l[1]-n)/(1-n)},getMix:function(s){return Math.sin(2*this._p[s]*Math.PI)}});
